<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Code Navigator</title>
    <style>
        /* ==================== CSS RESET & BASE ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #149CDC;
            --dark-blue: #0C5484;
            --charcoal: #2C4B5C;
            --light-gray: #E3E9EF;
            --medium-blue: #ACC9DB;
            --white: #ffffff;
            --text-dark: #1a1a1a;
            --shadow: rgba(12, 84, 132, 0.1);
            --hover-shadow: rgba(12, 84, 132, 0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--light-gray);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ==================== HEADER ==================== */
        .header {
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--primary-blue) 100%);
            color: var(--white);
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 12px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-align: center;
            margin-bottom: 1rem;
        }

        .search-bar-container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .search-bar {
            width: 100%;
            padding: 0.875rem 1.25rem 0.875rem 3rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            font-size: 1rem;
            background-color: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--white);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            background-color: var(--white);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--charcoal);
            font-size: 1.2rem;
        }

        /* ==================== MAIN CONTAINER ==================== */
        .main-container {
            display: flex;
            min-height: calc(100vh - 140px);
        }

        /* ==================== SIDEBAR ==================== */
        .sidebar {
            width: 250px;
            background-color: var(--white);
            box-shadow: 4px 0 12px var(--shadow);
            padding: 1.5rem 0;
            position: sticky;
            top: 140px;
            height: fit-content;
            max-height: calc(100vh - 160px);
            overflow-y: auto;
        }

        .nav-item {
            padding: 1rem 1.5rem;
            cursor: pointer;
            color: var(--charcoal);
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            position: relative;
        }

        .nav-item:hover {
            background-color: var(--light-gray);
            border-left-color: var(--primary-blue);
            color: var(--dark-blue);
        }

        .nav-item.active {
            background-color: rgba(20, 156, 220, 0.1);
            border-left-color: var(--primary-blue);
            color: var(--primary-blue);
            font-weight: 600;
        }

        .nav-item.has-dropdown::after {
            content: '‚ñº';
            position: absolute;
            right: 1.5rem;
            font-size: 0.7rem;
            transition: transform 0.3s ease;
        }

        .nav-item.has-dropdown.open::after {
            transform: rotate(-180deg);
        }

        .dropdown-menu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background-color: var(--light-gray);
        }

        .dropdown-menu.open {
            max-height: 300px;
        }

        .dropdown-item {
            padding: 0.75rem 1.5rem 0.75rem 2.5rem;
            cursor: pointer;
            color: var(--charcoal);
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .dropdown-item:hover {
            background-color: var(--medium-blue);
            color: var(--white);
        }

        .dropdown-item.active {
            background-color: var(--primary-blue);
            color: var(--white);
            font-weight: 500;
        }

        /* ==================== CONTENT AREA ==================== */
        .content-area {
            flex: 1;
            padding: 2rem;
            background-color: var(--light-gray);
        }

        .page {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ==================== HOME PAGE ==================== */
        .home-page {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--dark-blue);
            margin-bottom: 1.5rem;
            font-weight: 600;
            border-bottom: 3px solid var(--primary-blue);
            padding-bottom: 0.5rem;
        }

        /* ==================== ADVANCED SEARCH SECTION ==================== */
        .advanced-search-section {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
            margin-bottom: 2rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-weight: 500;
            color: var(--charcoal);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .filter-select,
        .filter-input {
            padding: 0.75rem;
            border: 2px solid var(--medium-blue);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: var(--white);
        }

        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(20, 156, 220, 0.1);
        }

        .search-button {
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: var(--white);
            padding: 0.875rem 2.5rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--hover-shadow);
        }

        .search-button:active {
            transform: translateY(0);
        }

        /* ==================== FEATURED CODES ==================== */
        .featured-codes {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .code-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .code-card {
            background: linear-gradient(135deg, var(--white) 0%, var(--light-gray) 100%);
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid var(--medium-blue);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .code-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px var(--hover-shadow);
            border-color: var(--primary-blue);
        }

        .code-card h3 {
            color: var(--dark-blue);
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .code-card p {
            color: var(--charcoal);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .code-badge {
            display: inline-block;
            background-color: var(--primary-blue);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* ==================== CODE CONTENT PAGE ==================== */
        .code-content {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
            max-width: 1200px;
            margin: 0 auto;
        }

        .code-header {
            border-bottom: 3px solid var(--primary-blue);
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        .code-header h2 {
            color: var(--dark-blue);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .code-meta {
            color: var(--charcoal);
            font-size: 0.95rem;
        }

        .code-section {
            margin-bottom: 2rem;
        }

        .code-section h3 {
            color: var(--dark-blue);
            font-size: 1.3rem;
            margin-bottom: 1rem;
            padding-left: 0.75rem;
            border-left: 4px solid var(--primary-blue);
        }

        .code-text {
            background-color: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
            line-height: 1.8;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            color: var(--text-dark);
            white-space: pre-wrap;
        }

        /* ==================== SEARCH RESULTS PAGE ==================== */
        .search-results {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
            max-width: 1200px;
            margin: 0 auto;
        }

        .result-item {
            border-bottom: 1px solid var(--medium-blue);
            padding: 1.5rem 0;
            transition: all 0.3s ease;
        }

        .result-item:hover {
            background-color: var(--light-gray);
            padding-left: 1rem;
            margin-left: -1rem;
            margin-right: -1rem;
            padding-right: 1rem;
            border-radius: 8px;
        }

        .result-title {
            color: var(--primary-blue);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        .result-title:hover {
            text-decoration: underline;
        }

        .result-meta {
            color: var(--charcoal);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .result-snippet {
            color: var(--text-dark);
            line-height: 1.6;
        }

        .highlight {
            background-color: rgba(20, 156, 220, 0.3);
            font-weight: 600;
            padding: 0.1rem 0.2rem;
            border-radius: 3px;
        }

        /* ==================== COMPARE PAGE ==================== */
        .compare-page {
            max-width: 1400px;
            margin: 0 auto;
        }

        .compare-selector {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
            margin-bottom: 2rem;
        }

        .selector-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            align-items: center;
            margin-top: 1.5rem;
        }

        .vs-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            text-align: center;
        }

        .compare-button {
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: var(--white);
            padding: 0.875rem 2.5rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px var(--shadow);
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .compare-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--hover-shadow);
        }

        .compare-results {
            background-color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
            display: none;
        }

        .compare-results.active {
            display: block;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .comparison-panel {
            background-color: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .comparison-panel h3 {
            color: var(--dark-blue);
            margin-bottom: 1rem;
            font-size: 1.2rem;
            border-bottom: 2px solid var(--primary-blue);
            padding-bottom: 0.5rem;
        }

        .comparison-text {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.8;
            white-space: pre-wrap;
            background-color: var(--white);
            padding: 1rem;
            border-radius: 6px;
        }

        .diff-added {
            background-color: rgba(76, 175, 80, 0.2);
            border-left: 3px solid #4CAF50;
            padding-left: 0.5rem;
        }

        .diff-removed {
            background-color: rgba(244, 67, 54, 0.2);
            border-left: 3px solid #F44336;
            padding-left: 0.5rem;
        }

        .diff-modified {
            background-color: rgba(255, 193, 7, 0.2);
            border-left: 3px solid #FFC107;
            padding-left: 0.5rem;
        }

        /* ==================== LOADING SPINNER ==================== */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid var(--light-gray);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ==================== RESPONSIVE DESIGN ==================== */
        @media (max-width: 768px) {
            .sidebar {
                position: static;
                width: 100%;
            }

            .main-container {
                flex-direction: column;
            }

            .filter-grid,
            .code-grid,
            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .selector-grid {
                grid-template-columns: 1fr;
            }

            .vs-text {
                margin: 1rem 0;
            }
        }

        /* ==================== UTILITIES ==================== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-2 {
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <h1>US Code Navigator</h1>
        <div class="search-bar-container">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-bar" id="globalSearch" placeholder="Search US codes, regulations, and standards...">
        </div>
    </header>

    <!-- MAIN CONTAINER -->
    <div class="main-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <nav>
                <div class="nav-item active" data-page="home">Home</div>
                <div class="nav-item has-dropdown" data-page="code">ÏΩîÎìú</div>
                <div class="dropdown-menu" id="codeDropdown">
                    <div class="dropdown-item" data-code="ibc">IBC 2024</div>
                    <div class="dropdown-item" data-code="nfpa13">NFPA 13</div>
                    <div class="dropdown-item" data-code="nfpa20">NFPA 20</div>
                    <div class="dropdown-item" data-code="nfpa72">NFPA 72</div>
                </div>
                <div class="nav-item" data-page="search">Í≤ÄÏÉâ</div>
                <div class="nav-item" data-page="compare">ÎπÑÍµê</div>
            </nav>
        </aside>

        <!-- CONTENT AREA -->
        <main class="content-area">
            <!-- HOME PAGE -->
            <div class="page active" id="homePage">
                <div class="home-page">
                    <!-- ADVANCED SEARCH SECTION -->
                    <section class="advanced-search-section">
                        <h2 class="section-title">Advanced Search</h2>
                        <div class="filter-grid">
                            <div class="filter-group">
                                <label class="filter-label">Code Type</label>
                                <select class="filter-select" id="homeCodeType">
                                    <option value="">All Codes</option>
                                    <option value="ibc">IBC</option>
                                    <option value="nfpa">NFPA</option>
                                    <option value="ifc">IFC</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Year</label>
                                <select class="filter-select" id="homeYear">
                                    <option value="">All Years</option>
                                    <option value="2024">2024</option>
                                    <option value="2021">2021</option>
                                    <option value="2018">2018</option>
                                    <option value="2015">2015</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Category</label>
                                <select class="filter-select" id="homeCategory">
                                    <option value="">All Categories</option>
                                    <option value="fire">Fire Protection</option>
                                    <option value="building">Building Construction</option>
                                    <option value="sprinkler">Sprinkler Systems</option>
                                    <option value="alarm">Fire Alarm Systems</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Keyword</label>
                                <input type="text" class="filter-input" id="homeKeyword" placeholder="Enter keyword...">
                            </div>
                        </div>
                        <button class="search-button" onclick="performAdvancedSearch()">Search</button>
                    </section>

                    <!-- FEATURED CODES -->
                    <section class="featured-codes">
                        <h2 class="section-title">Featured Codes</h2>
                        <div class="code-grid">
                            <div class="code-card" onclick="viewCode('ibc')">
                                <h3>IBC 2024</h3>
                                <p>International Building Code - Comprehensive building safety regulations</p>
                                <span class="code-badge">Building</span>
                            </div>
                            <div class="code-card" onclick="viewCode('nfpa13')">
                                <h3>NFPA 13</h3>
                                <p>Standard for the Installation of Sprinkler Systems</p>
                                <span class="code-badge">Fire Protection</span>
                            </div>
                            <div class="code-card" onclick="viewCode('nfpa20')">
                                <h3>NFPA 20</h3>
                                <p>Standard for the Installation of Stationary Pumps for Fire Protection</p>
                                <span class="code-badge">Fire Protection</span>
                            </div>
                            <div class="code-card" onclick="viewCode('nfpa72')">
                                <h3>NFPA 72</h3>
                                <p>National Fire Alarm and Signaling Code</p>
                                <span class="code-badge">Fire Alarm</span>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- CODE CONTENT PAGE -->
            <div class="page" id="codePage">
                <div class="code-content">
                    <div class="code-header">
                        <h2 id="codeTitle">Code Title</h2>
                        <p class="code-meta">
                            <span id="codeYear"></span> |
                            <span id="codeCategory"></span>
                        </p>
                    </div>
                    <div id="codeContent">
                        <!-- Dynamic code content will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- SEARCH PAGE -->
            <div class="page" id="searchPage">
                <div class="advanced-search-section">
                    <h2 class="section-title">Advanced Search</h2>
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label class="filter-label">Code Type</label>
                            <select class="filter-select" id="searchCodeType">
                                <option value="">All Codes</option>
                                <option value="ibc">IBC</option>
                                <option value="nfpa">NFPA</option>
                                <option value="ifc">IFC</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Year</label>
                            <select class="filter-select" id="searchYear">
                                <option value="">All Years</option>
                                <option value="2024">2024</option>
                                <option value="2021">2021</option>
                                <option value="2018">2018</option>
                                <option value="2015">2015</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Category</label>
                            <select class="filter-select" id="searchCategory">
                                <option value="">All Categories</option>
                                <option value="fire">Fire Protection</option>
                                <option value="building">Building Construction</option>
                                <option value="sprinkler">Sprinkler Systems</option>
                                <option value="alarm">Fire Alarm Systems</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Section Number</label>
                            <input type="text" class="filter-input" id="searchSection" placeholder="e.g., 903.3.1">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Keyword</label>
                            <input type="text" class="filter-input" id="searchKeyword" placeholder="Enter keyword...">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Full Text Search</label>
                            <input type="text" class="filter-input" id="searchFullText" placeholder="Search in content...">
                        </div>
                    </div>
                    <button class="search-button" onclick="performDetailedSearch()">Search</button>
                </div>

                <div class="search-results" id="searchResults">
                    <!-- Search results will be displayed here -->
                </div>
            </div>

            <!-- COMPARE PAGE -->
            <div class="page" id="comparePage">
                <div class="compare-page">
                    <div class="compare-selector">
                        <h2 class="section-title">Code Comparison</h2>
                        <div class="selector-grid">
                            <div class="filter-group">
                                <label class="filter-label">First Code</label>
                                <select class="filter-select" id="compareCode1">
                                    <option value="">Select code...</option>
                                    <option value="ibc">IBC 2024</option>
                                    <option value="nfpa13">NFPA 13</option>
                                    <option value="nfpa20">NFPA 20</option>
                                    <option value="nfpa72">NFPA 72</option>
                                </select>
                                <label class="filter-label" style="margin-top: 1rem;">Section</label>
                                <input type="text" class="filter-input" id="compareSection1" placeholder="e.g., 903.3.1">
                            </div>
                            <div class="vs-text">VS</div>
                            <div class="filter-group">
                                <label class="filter-label">Second Code</label>
                                <select class="filter-select" id="compareCode2">
                                    <option value="">Select code...</option>
                                    <option value="ibc">IBC 2024</option>
                                    <option value="nfpa13">NFPA 13</option>
                                    <option value="nfpa20">NFPA 20</option>
                                    <option value="nfpa72">NFPA 72</option>
                                </select>
                                <label class="filter-label" style="margin-top: 1rem;">Section</label>
                                <input type="text" class="filter-input" id="compareSection2" placeholder="e.g., 903.3.1">
                            </div>
                        </div>
                        <button class="compare-button" onclick="performComparison()">Compare Codes</button>
                    </div>

                    <div class="compare-results" id="compareResults">
                        <h2 class="section-title">Comparison Results</h2>
                        <div class="comparison-grid">
                            <div class="comparison-panel">
                                <h3 id="compare1Title">Code 1</h3>
                                <div class="comparison-text" id="compare1Content"></div>
                            </div>
                            <div class="comparison-panel">
                                <h3 id="compare2Title">Code 2</h3>
                                <div class="comparison-text" id="compare2Content"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ==================== DATA STRUCTURE ====================
        const codeDatabase = {
            ibc: {
                id: 'ibc',
                title: 'International Building Code (IBC) 2024',
                year: '2024',
                category: 'Building Construction',
                sections: {
                    '903.3.1': {
                        title: 'NFPA 13 Installation',
                        content: `903.3.1 NFPA 13 Installation

Where required by this code, automatic sprinkler systems shall be installed in accordance with Section 903.3.1.1, 903.3.1.2 or 903.3.1.3.

Exception: In buildings and structures, other than one- and two-family dwellings, equipped throughout with an automatic sprinkler system in accordance with this section, and where the building or structure has a building area not exceeding 5,000 square feet (465 m¬≤), automatic sprinklers shall be installed throughout the building or structure.

903.3.1.1 NFPA 13 Sprinkler Systems
Where required, automatic sprinkler systems shall be installed throughout in accordance with NFPA 13, including the provisions for monitoring and supervision.

Exception: Spaces where sprinklers are not required by Section 903.3.1.1.1.

903.3.1.2 NFPA 13R Sprinkler Systems
Automatic sprinkler systems installed in one- and two-family dwellings, Group R-3 and R-4 congregate living facilities shall be installed in accordance with NFPA 13R or Section 903.3.1.3.`,
                        type: 'Fire Protection',
                        keywords: ['sprinkler', 'NFPA 13', 'installation', 'automatic']
                    },
                    '1003.2': {
                        title: 'Ceiling Height',
                        content: `1003.2 Ceiling Height

The means of egress shall have a ceiling height of not less than 7 feet 6 inches (2286 mm).

Exceptions:
1. Sloped ceilings in accordance with Section 1003.2.1.
2. Ceilings of dwelling units and sleeping units within residential occupancies in accordance with Section 1208.2.
3. Allowable projections in accordance with Section 1003.3.
4. Stair headroom in accordance with Section 1011.3.
5. Door height in accordance with Section 1010.1.1.`,
                        type: 'Building Construction',
                        keywords: ['ceiling', 'height', 'egress', 'means of egress']
                    }
                }
            },
            nfpa13: {
                id: 'nfpa13',
                title: 'NFPA 13 - Standard for the Installation of Sprinkler Systems',
                year: '2022',
                category: 'Fire Protection - Sprinkler Systems',
                sections: {
                    '8.3.1': {
                        title: 'Sprinkler Spacing',
                        content: `8.3.1 Distance Between Sprinklers

8.3.1.1 The distance between sprinklers shall not exceed the maximum spacing indicated in Table 8.6.2.2.1(a), Table 8.6.2.2.1(b), Table 8.6.2.2.1(c), or Table 8.6.2.2.1(d), as applicable.

8.3.1.2 The minimum distance between sprinklers shall be 6 ft (1.8 m).

Exception: Sprinklers installed in staggered or opposite rows may be installed closer than 6 ft (1.8 m) when the distance between adjacent sprinklers on the same branch line is not less than 6 ft (1.8 m).

8.3.1.3 Sprinklers on the same branch line shall be equally spaced or nearly equally spaced as practicable.`,
                        type: 'Sprinkler Systems',
                        keywords: ['sprinkler spacing', 'distance', 'installation', 'branch line']
                    },
                    '10.1': {
                        title: 'Water Supply Requirements',
                        content: `10.1 Water Supply Requirements

10.1.1 General
Every automatic sprinkler system shall have at least one automatic water supply.

10.1.2 Minimum Water Supply
The water supply shall be capable of delivering the design demand, including the hose stream allowance where provided, for the prescribed design areas and densities specified in Chapter 11 through Chapter 23.

10.1.3 Duration
The water supply shall be capable of delivering the required demand for a minimum duration as specified in the applicable occupancy design criteria.

10.1.4 Water Supply Sources
Acceptable water supply sources shall include one or more of the following:
(1) Waterworks systems
(2) Elevated tanks
(3) Pressure tanks
(4) Pump(s) taking suction from sources such as underground tanks, reservoirs, or other reliable sources`,
                        type: 'Sprinkler Systems',
                        keywords: ['water supply', 'automatic', 'demand', 'tank', 'pump']
                    }
                }
            },
            nfpa20: {
                id: 'nfpa20',
                title: 'NFPA 20 - Standard for the Installation of Stationary Pumps',
                year: '2022',
                category: 'Fire Protection - Fire Pumps',
                sections: {
                    '4.8': {
                        title: 'Pump Room Requirements',
                        content: `4.8 Pump Room Requirements

4.8.1 General
Fire pump rooms shall be used only for fire pumps and related equipment.

4.8.2 Ventilation
The pump room shall be adequately ventilated to prevent a temperature rise that would adversely affect the operation of the pump or driver.

4.8.3 Drainage
The pump room shall be provided with adequate drainage to remove water from leaks, drains, or testing operations.

4.8.4 Lighting
The pump room shall have adequate permanent lighting and at least one emergency light source.

4.8.5 Access
The pump room shall have adequate access for installation and maintenance of equipment.`,
                        type: 'Fire Pumps',
                        keywords: ['pump room', 'ventilation', 'drainage', 'lighting', 'requirements']
                    },
                    '4.14': {
                        title: 'Controllers',
                        content: `4.14 Controllers

4.14.1 General
Each fire pump shall be provided with an approved controller conforming to the requirements of this chapter and to the listings of an approved testing laboratory.

4.14.2 Controller Location
Controllers shall be located as close as practicable to the motors that they control and shall be within sight of the motors.

Exception: Controllers for vertical turbine pumps shall be permitted to be remotely located where the pump and motor are readily accessible and visible from the controller location.

4.14.3 Controller Type
Controllers shall be of the automatic type that starts the pump at a pressure drop and stops the pump when normal system pressure is restored.`,
                        type: 'Fire Pumps',
                        keywords: ['controller', 'automatic', 'motor', 'pressure', 'pump']
                    }
                }
            },
            nfpa72: {
                id: 'nfpa72',
                title: 'NFPA 72 - National Fire Alarm and Signaling Code',
                year: '2022',
                category: 'Fire Protection - Fire Alarm Systems',
                sections: {
                    '17.4': {
                        title: 'Smoke Detector Spacing',
                        content: `17.4 Smoke Detector Spacing

17.4.1 General
Smoke detectors shall be located on the ceiling or, if on a sidewall, between the ceiling and 12 in. (300 mm) down from the ceiling to the top of the detector.

17.4.2 Spacing - Smooth Ceiling
17.4.2.1 All points on the ceiling shall have a detector within a distance equal to 0.7 times the listed spacing of the detector.

17.4.2.2 Detectors shall be spaced with a minimum of two detectors in each room or space.

17.4.3 Spot-Type Detectors - Spacing
The spacing of smoke detectors shall not exceed their listed spacing, and the distance from a detector to the nearest wall or partition shall not exceed one-half the listed spacing.`,
                        type: 'Fire Alarm Systems',
                        keywords: ['smoke detector', 'spacing', 'ceiling', 'installation']
                    },
                    '23.8': {
                        title: 'Fire Alarm Control Units',
                        content: `23.8 Fire Alarm Control Units

23.8.1 General
The fire alarm control unit(s) shall be listed for the application and installed in accordance with the listing.

23.8.2 Location
Fire alarm control units shall be located in a room or area that is continuously accessible to authorized personnel.

23.8.3 Environmental Conditions
Fire alarm control units shall be located where ambient conditions do not exceed the environmental limits specified in the product listing.

23.8.4 Power Supply
The fire alarm control unit shall be provided with both primary and secondary power supplies in accordance with Chapter 10.

23.8.5 Monitoring
Where required, the fire alarm system shall be monitored for alarm, supervisory, and trouble signals at a constantly attended location.`,
                        type: 'Fire Alarm Systems',
                        keywords: ['control unit', 'FACU', 'power supply', 'monitoring', 'installation']
                    }
                }
            }
        };

        // ==================== NAVIGATION ====================
        let currentPage = 'home';
        let currentCode = null;

        // Initialize navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const page = this.dataset.page;

                if (page === 'code') {
                    toggleDropdown();
                } else {
                    navigateToPage(page);
                }
            });
        });

        // Dropdown items
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', function() {
                const code = this.dataset.code;
                viewCode(code);
            });
        });

        function toggleDropdown() {
            const dropdown = document.getElementById('codeDropdown');
            const navItem = document.querySelector('.nav-item[data-page="code"]');

            dropdown.classList.toggle('open');
            navItem.classList.toggle('open');
        }

        function navigateToPage(page) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });

            // Show selected page
            document.getElementById(page + 'Page').classList.add('active');

            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.querySelector(`.nav-item[data-page="${page}"]`).classList.add('active');

            // Close dropdown if open
            document.getElementById('codeDropdown').classList.remove('open');
            document.querySelector('.nav-item[data-page="code"]').classList.remove('open');

            currentPage = page;
        }

        function viewCode(codeId) {
            currentCode = codeId;
            const code = codeDatabase[codeId];

            if (!code) {
                alert('Code not found');
                return;
            }

            // Update code page content
            document.getElementById('codeTitle').textContent = code.title;
            document.getElementById('codeYear').textContent = code.year;
            document.getElementById('codeCategory').textContent = code.category;

            // Build sections content
            let contentHTML = '';
            for (const [sectionNum, section] of Object.entries(code.sections)) {
                contentHTML += `
                    <div class="code-section">
                        <h3>Section ${sectionNum}: ${section.title}</h3>
                        <div class="code-text">${section.content}</div>
                    </div>
                `;
            }

            document.getElementById('codeContent').innerHTML = contentHTML;

            // Navigate to code page
            navigateToPage('code');

            // Update dropdown selection
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.dropdown-item[data-code="${codeId}"]`).classList.add('active');
        }

        // ==================== SEARCH FUNCTIONALITY ====================
        document.getElementById('globalSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performGlobalSearch(this.value);
            }
        });

        function performGlobalSearch(query) {
            if (!query.trim()) return;

            // Navigate to search page and perform search
            navigateToPage('search');
            document.getElementById('searchFullText').value = query;
            performDetailedSearch();
        }

        function performAdvancedSearch() {
            // Get home page filter values
            const codeType = document.getElementById('homeCodeType').value;
            const year = document.getElementById('homeYear').value;
            const category = document.getElementById('homeCategory').value;
            const keyword = document.getElementById('homeKeyword').value;

            // Navigate to search page
            navigateToPage('search');

            // Set search page filters
            document.getElementById('searchCodeType').value = codeType;
            document.getElementById('searchYear').value = year;
            document.getElementById('searchCategory').value = category;
            document.getElementById('searchKeyword').value = keyword;

            // Perform search
            performDetailedSearch();
        }

        function performDetailedSearch() {
            const filters = {
                codeType: document.getElementById('searchCodeType').value,
                year: document.getElementById('searchYear').value,
                category: document.getElementById('searchCategory').value,
                section: document.getElementById('searchSection').value,
                keyword: document.getElementById('searchKeyword').value,
                fullText: document.getElementById('searchFullText').value
            };

            const results = searchCodes(filters);
            displaySearchResults(results, filters.fullText || filters.keyword);
        }

        function searchCodes(filters) {
            let results = [];

            for (const [codeId, code] of Object.entries(codeDatabase)) {
                // Filter by code type
                if (filters.codeType && !codeId.includes(filters.codeType)) continue;

                // Filter by year
                if (filters.year && code.year !== filters.year) continue;

                // Search in sections
                for (const [sectionNum, section] of Object.entries(code.sections)) {
                    let match = true;

                    // Filter by section number
                    if (filters.section && !sectionNum.includes(filters.section)) {
                        match = false;
                    }

                    // Filter by keyword
                    if (filters.keyword) {
                        const keywordLower = filters.keyword.toLowerCase();
                        const hasKeyword = section.keywords.some(k => k.includes(keywordLower)) ||
                                         section.title.toLowerCase().includes(keywordLower);
                        if (!hasKeyword) match = false;
                    }

                    // Filter by full text
                    if (filters.fullText) {
                        const textLower = filters.fullText.toLowerCase();
                        const hasText = section.content.toLowerCase().includes(textLower);
                        if (!hasText) match = false;
                    }

                    if (match) {
                        results.push({
                            codeId: codeId,
                            codeTitle: code.title,
                            sectionNum: sectionNum,
                            sectionTitle: section.title,
                            content: section.content,
                            type: section.type
                        });
                    }
                }
            }

            return results;
        }

        function displaySearchResults(results, searchTerm) {
            const resultsContainer = document.getElementById('searchResults');

            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="text-center" style="padding: 2rem;">
                        <h3 style="color: var(--charcoal);">No results found</h3>
                        <p style="color: var(--charcoal); margin-top: 1rem;">Try adjusting your search filters</p>
                    </div>
                `;
                return;
            }

            let html = `<h2 class="section-title">Search Results (${results.length} found)</h2>`;

            results.forEach(result => {
                let snippet = result.content.substring(0, 300) + '...';

                // Highlight search term
                if (searchTerm) {
                    const regex = new RegExp(`(${escapeRegExp(searchTerm)})`, 'gi');
                    snippet = snippet.replace(regex, '<span class="highlight">$1</span>');
                }

                html += `
                    <div class="result-item">
                        <div class="result-title" onclick="viewCodeSection('${result.codeId}', '${result.sectionNum}')">
                            ${result.codeTitle} - Section ${result.sectionNum}
                        </div>
                        <div class="result-meta">
                            ${result.type} | ${result.sectionTitle}
                        </div>
                        <div class="result-snippet">${snippet}</div>
                    </div>
                `;
            });

            resultsContainer.innerHTML = html;
        }

        function viewCodeSection(codeId, sectionNum) {
            viewCode(codeId);
            // Scroll to specific section
            setTimeout(() => {
                const sections = document.querySelectorAll('.code-section h3');
                sections.forEach(section => {
                    if (section.textContent.includes(sectionNum)) {
                        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            }, 300);
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // ==================== COMPARISON FUNCTIONALITY ====================
        function performComparison() {
            const code1Id = document.getElementById('compareCode1').value;
            const code2Id = document.getElementById('compareCode2').value;
            const section1 = document.getElementById('compareSection1').value;
            const section2 = document.getElementById('compareSection2').value;

            if (!code1Id || !code2Id) {
                alert('Please select both codes to compare');
                return;
            }

            const code1 = codeDatabase[code1Id];
            const code2 = codeDatabase[code2Id];

            if (!code1 || !code2) {
                alert('Selected codes not found');
                return;
            }

            // Get section content
            let content1, content2, title1, title2;

            if (section1 && code1.sections[section1]) {
                content1 = code1.sections[section1].content;
                title1 = `${code1.title} - Section ${section1}`;
            } else {
                // Get first section
                const firstSection = Object.entries(code1.sections)[0];
                content1 = firstSection[1].content;
                title1 = `${code1.title} - Section ${firstSection[0]}`;
            }

            if (section2 && code2.sections[section2]) {
                content2 = code2.sections[section2].content;
                title2 = `${code2.title} - Section ${section2}`;
            } else {
                // Get first section
                const firstSection = Object.entries(code2.sections)[0];
                content2 = firstSection[1].content;
                title2 = `${code2.title} - Section ${firstSection[0]}`;
            }

            // Display comparison
            displayComparison(title1, content1, title2, content2);
        }

        function displayComparison(title1, content1, title2, content2) {
            document.getElementById('compare1Title').textContent = title1;
            document.getElementById('compare2Title').textContent = title2;

            // Perform simple diff
            const lines1 = content1.split('\n');
            const lines2 = content2.split('\n');

            // Highlight differences
            let highlighted1 = highlightDifferences(lines1, lines2);
            let highlighted2 = highlightDifferences(lines2, lines1);

            document.getElementById('compare1Content').innerHTML = highlighted1;
            document.getElementById('compare2Content').innerHTML = highlighted2;

            // Show results
            document.getElementById('compareResults').classList.add('active');
        }

        function highlightDifferences(linesA, linesB) {
            let result = '';

            linesA.forEach((line, index) => {
                if (index < linesB.length) {
                    if (line.trim() === linesB[index].trim()) {
                        // Same line
                        result += `<div>${escapeHtml(line)}</div>`;
                    } else if (linesB.some(l => l.trim() === line.trim())) {
                        // Line exists but in different position
                        result += `<div class="diff-modified">${escapeHtml(line)}</div>`;
                    } else {
                        // Unique line
                        result += `<div class="diff-added">${escapeHtml(line)}</div>`;
                    }
                } else {
                    // Extra line
                    result += `<div class="diff-added">${escapeHtml(line)}</div>`;
                }
            });

            return result;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('US Code Navigator initialized');
        });
    </script>
</body>
</html>
