<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>US CODE NAVIGATOR</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    body{
      display:flex;flex-direction:column;
      font-family:'Helvetica','Malgun Gothic','맑은 고딕',sans-serif;
      background-color:#F7FAFD;color:#333;line-height:1.6;
    }
    mark{background:#FFEC7A;padding:0 .15em;border-radius:.15em}

    /* Header */
    .header{background:linear-gradient(135deg,#03419A,#2A5FAA);color:#fff;padding:1rem 2rem;box-shadow:0 2px 10px rgba(0,0,0,.1)}
    .brand{display:flex;align-items:center;gap:.6rem}
    .header h1{font-size:1.8rem;font-weight:700;letter-spacing:.6px;line-height:1}
    .compass{width:1.8rem;height:1.8rem;stroke:#ffffff;opacity:.95;flex:0 0 1.8rem}

    .container{display:flex;flex:1 1 auto;min-height:0}
    .sidebar{width:350px;background:#fff;border-right:1px solid #DBE9F9;overflow-y:auto;box-shadow:2px 0 10px rgba(0,0,0,.05)}
    .search-container{position:relative;padding:1.5rem;border-bottom:1px solid #DBE9F9;background:#F7FAFD}
    .search-box{width:100%;padding:.75rem 3.0rem .75rem .75rem;border:2px solid #DBE9F9;border-radius:8px;font-size:.95rem;transition:border-color .3s}
    .search-box:focus{outline:none;border-color:#218FFF}
    .clear-search-btn{
      position:absolute;right:1.6rem;top:50%;transform:translateY(-50%);
      display:none;background:#fff;border:1px solid #DBE9F9;border-radius:6px;padding:.25rem;cursor:pointer
    }
    .clear-search-btn:hover{background:#F7FAFD;border-color:#218FFF}

    /* 최근 검색 제안 */
    .recent-suggest{
      position:absolute; left:1.5rem; right:1.5rem; top:calc(100% - .6rem);
      background:#fff; border:1px solid #DBE9F9; border-radius:8px;
      box-shadow:0 6px 20px rgba(0,0,0,.06); padding:.4rem; z-index:1001;
      max-height:240px; overflow:auto; display:none;
    }
    .recent-suggest h6{
      font-size:.75rem; color:#678; font-weight:600; padding:.25rem .4rem; margin:0;
      text-transform:uppercase; letter-spacing:.04em;
    }
    .recent-item{
      display:flex; align-items:center; justify-content:space-between;
      gap:.5rem; padding:.45rem .55rem; border-radius:6px; font-size:.9rem; cursor:pointer;
    }
    .recent-item:hover{ background:#F2F7FF; }
    .recent-term{flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .recent-remove{
      flex:0 0 auto; border:none; background:transparent; color:#9aa; font-weight:700; cursor:pointer;
      width:22px; height:22px; border-radius:4px; display:inline-flex; align-items:center; justify-content:center;
    }
    .recent-remove:hover{ background:#EEF4FE; color:#c33; }
    .recent-suggest .empty{ padding:.5rem; color:#999; font-size:.85rem; }

    .menu-section{padding:1rem;border-bottom:1px solid #EEF4FE}
    .menu-title{display:flex;align-items:center;justify-content:space-between;gap:.5rem;font-weight:600;color:#03419A;margin-bottom:.5rem;font-size:.9rem;text-transform:uppercase;letter-spacing:.5px;cursor:pointer}
    .menu-title .icon{width:16px;height:16px;flex:0 0 16px}
    .menu-content{display:none;}
    .menu-content.show{display:block;}
    .menu-item{cursor:pointer;padding:.5rem;border-radius:6px;margin-bottom:.25rem;transition:all .2s;font-size:.85rem;display:flex;align-items:center;gap:.5rem}
    .menu-item:hover{background-color:#DBE9F9}
    .menu-item.active{background-color:#218FFF;color:#fff;font-weight:700}
    .submenu{margin-left:1rem;display:none}
    .submenu.show{display:block}

    .main-content{flex:1;padding:2rem;overflow-y:auto;position:relative}
    .content-header{margin-bottom:.6rem;display:flex;justify-content:space-between;align-items:flex-end;gap:.5rem}
    .title-wrap{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}
    .title-wrap h2{font-size:1.25rem}
    .title-wrap small{color:#666}
    .view-toggle-btn{display:inline-flex;align-items:center;justify-content:center;border:1px solid #CFE0FB;background:#EFF5FF;color:#2A5FAA;border-radius:8px;padding:.25rem;cursor:pointer;transition:.2s}
    .view-toggle-btn svg{width:18px;height:18px}
    .view-toggle-btn:hover{background:#E6F0FF;border-color:#BFD6FA;color:#03419A}

    .filter-controls{display:flex;align-items:center;gap:.35rem;position:relative;margin-top:0}
    .filter-btn,.reset-btn{background:#EFF5FF;border:1px solid #CFE0FB;padding:.3rem;border-radius:8px;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;color:#2A5FAA}
    .filter-btn svg,.reset-btn svg{width:18px;height:18px}
    .filter-btn:hover,.reset-btn:hover{background:#E6F0FF;border-color:#BFD6FA}
    .filter-btn.active{background:#218FFF;color:#fff;border-color:#218FFF}

    .filter-panel{position:absolute;top:100%;right:0;background:#fff;border:1px solid #DBE9F9;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.1);padding:1rem;width:320px;z-index:1000;display:none}
    .filter-section{margin-bottom:1rem}
    .filter-section:last-child{margin-bottom:0}
    .filter-title{display:flex;align-items:center;gap:.5rem;font-weight:600;color:#03419A;margin-bottom:.5rem;font-size:.9rem}
    .filter-options{margin-left:1.5rem}
    .filter-option{display:flex;align-items:center;gap:.5rem;margin-bottom:.25rem;font-size:.85rem}
    .filter-input{display:flex;align-items:center;gap:.5rem;margin-top:.25rem}
    .filter-input input{width:60px;padding:.25rem;border:1px solid #DBE9F9;border-radius:4px;font-size:.8rem;background:#F9FBFF;}
    .filter-input input::placeholder{ color:#BFD3F6; opacity:1; }

    .active-filters{display:flex;flex-wrap:wrap;gap:.25rem;margin-top:.25rem}
    .active-filter{background:#218FFF;color:#fff;padding:.2rem .4rem;border-radius:4px;font-size:.7rem;display:flex;align-items:center;gap:.25rem}
    .filter-remove{cursor:pointer;font-weight:bold}

    .results-container{
      background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.08);overflow:hidden;margin-top:.6rem;
      position:relative;  /* 스크롤 버튼을 컨테이너 기준으로 배치 */
    }
    .result-item{position:relative;padding:1.1rem 1.2rem;border-bottom:1px solid #DBE9F9}
    .result-item:last-child{border-bottom:none}
    .copy-btn,.bookmark-btn{position:absolute;top:8px;background:#fff;border:1px solid #DBE9F9;border-radius:8px;padding:.2rem;cursor:pointer;transition:all .2s}
    .copy-btn{right:36px}
    .bookmark-btn{right:8px}
    .copy-btn svg,.bookmark-btn svg{width:14px;height:14px}
    .copy-btn:hover,.bookmark-btn:hover{background:#F7FAFD;border-color:#218FFF}
    .bookmark-btn.active{background:#FFE7A3;border-color:#FFC34D}

    .toast{position:absolute;top:8px;right:64px;background:#218FFF;color:#fff;border-radius:6px;padding:.15rem .35rem;font-size:.68rem;opacity:0;transform:translateY(-4px);transition:all .2s}
    .toast.show{opacity:1;transform:translateY(0)}

    .provision-number{font-weight:700;color:#03419A;font-size:1.06rem;margin-bottom:.45rem;padding-right:64px}
    .title-section{margin-bottom:.6rem}
    .title-en{font-weight:700;color:#2A5FAA;margin-bottom:.15rem;text-transform:uppercase}
    .title-ko{color:#666;font-style:italic}
    .content-section{margin-bottom:.6rem}
    .content-en{margin-bottom:.45rem;line-height:1.7}
    .content-ko{color:#555;font-size:.9rem;line-height:1.6}
    /* Notes box (CSS 유지) */
    .notes{background:#F7FAFD;padding:.55rem;border-left:4px solid #218FFF;margin:.7rem 0;font-size:.9rem;color:#2a3a55}

    .keywords{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.6rem}
    .keyword{background:#DBE9F9;color:#03419A;padding:.18rem .45rem;border-radius:4px;font-size:.75rem;cursor:pointer;transition:all .2s}
    .keyword:hover{background:#218FFF;color:#fff}

    .pagination{display:flex;justify-content:center;align-items:center;gap:.35rem;margin-top:1rem;padding:1rem;flex-wrap:wrap}
    .page-btn{background:#fff;border:1px solid #DBE9F9;padding:.45rem .7rem;border-radius:6px;cursor:pointer;transition:all .2s;font-size:.9rem;min-width:36px;text-align:center}
    .page-btn:hover{background:#218FFF;color:#fff;border-color:#218FFF}
    .page-btn.active{background:#03419A;color:#fff;border-color:#03419A}
    .page-btn:disabled{opacity:.5;cursor:not-allowed}

    /* Scroll-up: 결과 박스 내부 우하단 고정 */
    .scroll-top{
      position:absolute; bottom:14px; right:14px; width:48px; height:48px; border:none;border-radius:50%;
      background:linear-gradient(135deg,#2A5FAA,#218FFF);color:#fff;cursor:pointer;display:none;
      align-items:center;justify-content:center;box-shadow:0 8px 18px rgba(33,143,255,.35);transition:all .25s;z-index:4
    }
    .scroll-top:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(3,65,154,.35)}
    .scroll-top svg{width:22px;height:22px;stroke:#fff}

    /* Popup (사이드바 침범 방지) */
    .popup{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:flex-start;justify-content:flex-start; padding:24px 32px; z-index:1100;}
    .popup-content{
      background:#fff;padding:1.4rem;border-radius:12px;
      margin-left:calc(350px + 32px);
      max-width:clamp(520px, 70vw, calc(100vw - 350px - 64px));
      width:clamp(520px, 70vw, calc(100vw - 350px - 64px));
      max-height:72vh; overflow-y:auto; box-shadow:0 10px 40px rgba(0,0,0,.2); position:relative;
      font-size:0.92rem;
    }
    @media (max-width: 900px){
      .popup{align-items:flex-start;justify-content:center}
      .popup-content{margin-left:0;max-width:min(92vw, 720px);width:min(92vw, 720px)}
    }
    .popup-close{position:absolute;top:.8rem;right:.8rem;font-size:1.5rem;cursor:pointer;color:#666;background:none;border:none}
    .popup-list{text-transform:uppercase;font-size:0.92rem;}
    .popup-item{padding:.8rem;border-bottom:1px solid #eee}
    .popup-item.open{background:#F2F7FF}
    .popup-item .bm-btn svg{width:14px;height:14px}
    .popup-detail{font-size:0.86rem;line-height:1.52;}

    /* List Mode */
    .list-item{border-bottom:1px solid #DBE9F9}
    .list-header{display:flex;align-items:center;justify-content:space-between;gap:.5rem;padding:1rem 1.2rem;cursor:pointer;background:#fff}
    .list-titles{display:flex;flex-direction:column}
    .list-num{font-weight:700;color:#03419A}
    .list-en{font-weight:700;color:#2A5FAA;text-transform:uppercase}
    .list-ko{color:#666;font-style:italic}
    .chev{transition:transform .2s}
    .list-content{display:none;padding:0 1.2rem 1rem 1.2rem;background:#FAFCFF}
    .list-item.open .list-content{display:block}
    .list-item.open .chev{transform:rotate(180deg)}

    /* Bookmark Floating Panel */
    .bookmark-panel{
      position:fixed;top:170px;left:auto;width:360px;max-height:70vh;overflow:auto;
      background:rgba(239,245,255,.96);
      border:1px solid #CFE0FB;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.12);
      backdrop-filter:saturate(110%); padding:12px;z-index:1200;display:none
    }
    .bookmark-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem;cursor:move}
    .bookmark-title{font-weight:700;color:#03419A}
    .bm-actions{display:flex;gap:.35rem}
    .bm-btn{background:#EFF5FF;border:1px solid #CFE0FB;border-radius:8px;padding:.25rem;cursor:pointer;color:#2A5FAA;display:flex;align-items:center;justify-content:center}
    .bm-btn svg{width:18px;height:18px}
    .bm-btn:hover{background:#E6F0FF;border-color:#BFD6FA}
    .bookmark-list .bm-row{display:flex;align-items:center;gap:.5rem;padding:.4rem .2rem;border-bottom:1px solid #EEF4FE}
    .bm-row:last-child{border-bottom:none}
    .bm-title{font-size:.9rem;text-transform:uppercase}
    .bm-empty{color:#777;padding:.75rem 0}

    .bm-handle{
      position:fixed;top:170px;left:auto;width:28px;height:44px;border:1px solid #CFE0FB;border-right:none;
      background:rgba(239,245,255,.96);border-radius:8px 0 0 8px;box-shadow:-6px 0 20px rgba(0,0,0,.06);
      display:none;align-items:center;justify-content:center;cursor:pointer;z-index:1201
    }
    .bm-handle span{font-weight:700;color:#2A5FAA}
    .bookmark-panel.collapsed{width:28px;padding:0;overflow:hidden}
    .bookmark-panel.collapsed .bookmark-header,
    .bookmark-panel.collapsed .bookmark-list{display:none}

    /* Print */
    @media print{
      body *{visibility:hidden !important;}
      .print-scope, .print-scope *{visibility:visible !important;}
      .print-scope{position:fixed;left:0;top:0;width:100%;padding:24px;background:#fff}
      .print-scope h2{margin:0 0 12px 0}
      .print-item{margin:12px 0;padding:12px;border-top:1px solid #ddd}
      .print-item h3{margin:0 0 8px 0}
      .muted{color:#666}
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="brand">
      <svg class="compass" viewBox="0 0 24 24" fill="none" stroke="currentColor"
           stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="9"></circle>
        <path d="M15.5 8.5 13 13l-4.5 2.5L11 11l4.5-2.5z"></path>
        <circle cx="12" cy="12" r="0.6" fill="#ffffff"></circle>
      </svg>
      <h1>US CODE NAVIGATOR</h1>
    </div>
  </div>

  <div class="container">
    <div class="sidebar">
      <div class="search-container">
        <input type="text" class="search-box" placeholder="Search provisions, keywords..." id="searchInput"/>
        <button class="clear-search-btn" id="clearSearch" aria-label="Clear search">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
               viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
          </svg>
        </button>
        <div class="recent-suggest" id="recentSuggest"></div>
      </div>

      <!-- CHAPTERS -->
      <div class="menu-section">
        <div class="menu-title" data-target="chaptersMenu">
          <span>IBC 2024</span>
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
               viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
        <div class="menu-content" id="chaptersMenu"></div>
      </div>

      <!-- DESIGN STAGES -->
      <div class="menu-section">
        <div class="menu-title" data-target="designStagesMenu">
          <span>DESIGN STAGES</span>
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
               viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
        <div class="menu-content" id="designStagesMenu"></div>
      </div>

      <!-- DESIGN CATEGORIES -->
      <div class="menu-section">
        <div class="menu-title" data-target="designCategoriesMenu">
          <span>DESIGN CATEGORIES</span>
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
               viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
        <div class="menu-content" id="designCategoriesMenu"></div>
      </div>

      <!-- PROJECT APPLICATION -->
      <div class="menu-section">
        <div class="menu-title" data-target="projectApplicationMenu">
          <span>PROJECT APPLICATION</span>
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
               viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
        <div class="menu-content" id="projectApplicationMenu"></div>
      </div>
    </div>

    <div class="main-content">
      <div class="content-header">
        <div class="title-wrap">
          <h2 id="contentTitle">Welcome to US Code Navigator</h2>
          <button id="viewToggle" class="view-toggle-btn" title="목록 보기 토글">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 5h8"/><path d="M3 12h8"/><path d="M3 19h8"/><path d="m15 5 3 3 3-3"/><path d="m15 19 3-3 3 3"/>
            </svg>
          </button>
          <small id="contentSubtitle">Search and explore IBC 2024 provisions</small>
          <div class="active-filters" id="activeFilters"></div>
        </div>

        <div class="filter-controls">
          <button class="filter-btn" id="filterBtn" title="Filters">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 5H3"/><path d="M12 19H3"/><path d="M14 3v4"/><path d="M16 17v4"/>
              <path d="M21 12h-9"/><path d="M21 19h-5"/><path d="M21 5h-7"/><path d="M8 10v4"/><path d="M8 12H3"/>
            </svg>
          </button>
          <button class="reset-btn" id="resetBtn" title="Refresh / Reset filters">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
              <path d="M3 3v5h5"/>
            </svg>
          </button>

          <div class="filter-panel" id="filterPanel">
            <div class="filter-section">
              <div class="filter-title">
                <input type="checkbox" id="codeAllCheck"/> Code
              </div>
              <div class="filter-options" id="codeOptions">
                <div class="filter-option">
                  <input type="checkbox" id="ibcCheck" value="IBC"/> IBC
                  <div class="filter-input">
                    <span>Ch.</span><input type="number" id="ibcChapter" placeholder="1"/>
                    <span>Sec.</span><input type="number" id="ibcSection" placeholder="1"/>
                  </div>
                </div>
                <div class="filter-option">
                  <input type="checkbox" id="nfpaCheck" value="NFPA"/> NFPA
                </div>
              </div>
            </div>

            <div class="filter-section">
              <div class="filter-title">
                <input type="checkbox" id="stageAllCheck"/> Stage
              </div>
              <div class="filter-options" id="stagesOptions">
                <div class="filter-option"><input type="checkbox" value="SD"/> SD</div>
                <div class="filter-option"><input type="checkbox" value="DD"/> DD</div>
                <div class="filter-option"><input type="checkbox" value="CD"/> CD</div>
              </div>
            </div>

            <div class="filter-section">
              <div class="filter-title">
                <input type="checkbox" id="categoryAllCheck"/> Categories
              </div>
              <div class="filter-options" id="categoriesOptions"></div>
            </div>

            <div class="filter-section">
              <div class="filter-title">
                <input type="checkbox" id="projectAllCheck"/> Project
              </div>
              <div class="filter-options" id="projectsOptions">
                <div class="filter-option"><input type="checkbox" value="GEORGIA"/> GEORGIA</div>
                <div class="filter-option"><input type="checkbox" value="SPE 1"/> SPE 1</div>
                <div class="filter-option"><input type="checkbox" value="SPE 2"/> SPE 2</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="results-container" id="resultsContainer">
        <div class="no-results">
          <h3>Ready to Navigate</h3>
          <p>Use the search box or menu to explore IBC provisions</p>
        </div>
        <!-- 결과 박스 내부 우하단 스크롤 버튼 -->
        <button class="scroll-top" id="scrollTop" title="Scroll to top">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <polyline points="18 15 12 9 6 15"></polyline>
          </svg>
        </button>
      </div>

      <div class="pagination" id="pagination" style="display:none;"></div>
    </div>
  </div>

  <!-- Keyword popup -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <button class="popup-close" onclick="closePopup()">&times;</button>
      <div id="popupContent"></div>
    </div>
  </div>

  <!-- Bookmark Floating Panel + Handle -->
  <div class="bookmark-panel" id="bookmarkPanel">
    <div class="bookmark-header" id="bookmarkHeader">
      <div class="bookmark-title">Bookmarks</div>
      <div class="bm-actions" id="bmActions">
        <button class="bm-btn" id="bookmarkCopyBtn" title="Copy selected bookmarks">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
          </svg>
        </button>
        <button class="bm-btn" id="bookmarkPrintBtn" title="Print selected bookmarks">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
            <path d="M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6"/>
            <rect x="6" y="14" width="12" height="8" rx="1"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="bookmark-list" id="bookmarkList"></div>
  </div>
  <div class="bm-handle" id="bmHandle"><span>&lt;</span></div>

  <script>
    /* =========================
       DATA
       ========================= */
    const ibcData = [
  {
    chapter:"IBC 2024",section:"",subsection:"",titleEn:"",
    titleKo:"본 페이지는 삼우의 건축 엔지니어들이 IBC의 구성을 이해하고 각 챕터 간의 연결성 및 코드의 정확한 이해와 적용을 통해, IBC를 건축법으로 적용해야 하는 미국 현지 프로젝트를 IBC에 부합하게 설계할 수 있는 기본적인 적용 가이드라인을 제공하는 것을 목적으로 합니다.",
    provisionEn:"",
    provisionKo:"IBC 역사: 미국에는 과거 지역별로 서로 다른 3개의 모델 건축코드가 있었습니다. 1994년 세 단체가 합쳐져 ICC가 설립되었고, 2000년 최초 IBC가 발행되었습니다. IBC는 3년 주기로 개정되며, 최신 개정판은 2024년입니다.",
    designStage:"SD",designCategory:"",projectApplication:"",notes:""
  },

  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"DEFINITIONS",titleKo:"",provisionEn:"",provisionKo:"Chapter 2는 산업시설 프로젝트에서 많이 사용되는 용어의 정의를 기술합니다. IBC를 정확히 이해하기 위해 무엇보다 우선적으로 수행되어야 할 사항은 용어 정의의 이해입니다. 용어의 정의를 올바르게 이해하지 못하면 코드 해석을 코드가 의도한 것과 다른 방향으로 이해 및 해석할 수 있고, 그러한 이해와 해석이 설계 단계에서 코드 적용의 오류로 이어질 수 있습니다.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"AREA",titleKo:"면적, 구획",provisionEn:"The area included within surrounding exterior walls, or exterior walls and fire walls, exclusive of vent shafts and courts. Areas of the building not provided with surrounding walls shall be included in the building area if such areas are included within the horizontal projection of the roof or floor above.",provisionKo:"외벽 또는 외벽 및 방화벽으로 둘러싸인 구역에 포함된 면적으로, 환기 샤프트 및 중정(Court)은 제외한다. 벽으로 둘러싸이지 않은 구역은 해당 구역이 상부 지붕 또는 바닥의 수평 투영 내에 포함되는 경우에 화재 구역에 포함한다.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"CLOSED SYSTEM",titleKo:"폐쇄형 시스템",provisionEn:"The use of a solid or liquid hazardous material involving a closed vessel or system that remains closed during normal operations where vapors emitted by the product are not liberated outside of the vessel or system and the product is not exposed to the atmosphere during normal operations; and all uses of compressed gases. Examples of closed systems for solids and liquids include product conveyed through a piping system into a closed vessel, system or piece of equipment.",provisionKo:"정상 운전 중에도 밀폐 상태를 유지하는 밀폐용기나 시스템을 사용하여 고체 또는 액체 위험물질을 취급하는 방식으로 제품에서 발생하는 증기가 용기나 시스템 외부로 방출되지 않으며, 정상 운전 중 제품이 대기에 노출되지 않는 사용법과 압축가스의 사용을 모두 포함한다.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"CONTROL AREA",titleKo:"관리 구역",provisionEn:"Spaces within a building where quantities of hazardous materials not exceeding the maximum allowable quantities per control area are stored, dispensed, used or handled. See the definition of \"Outdoor control area\" in the International Fire Code.",provisionKo:"건물 내에서 관리 구역당 최대 허용량을 초과하지 않는 범위의 위험물질을 저장, 분배, 사용 또는 취급하는 공간. IFC의 \"Outdoor control area (실외 관리구역)\" 정의 참조.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"CORROSIVE",titleKo:"부식성 물질",provisionEn:"A chemical that causes visible destruction of, or irreversible alterations in, living tissue by chemical action at the point of contact. A chemical shall be considered corrosive if, when tested on the intact skin of albino rabbits by the method described in DOTn 49 CFR, Part 173.137, such chemical destroys or changes irreversibly the structure of the tissue at the point of contact following an exposure period of 4 hours. This term does not refer to action on inanimate surfaces.",provisionKo:"접촉 시 화학적 작용으로 생체조직에 가시적 손상을 일으키거나 비가역적 변화를 일으키는 화학물질. DOT 49 CFR, Part 173.137에 명시된 방법에 의해 알비노 토끼의 온전한 피부에 시험했을 때, 4시간 노출 후 접촉점의 조직 구조를 파괴하거나 비가역적으로 변화시키는 화학물질을 부식성으로 간주한다. 이 용어는 무기물 표면에 대한 작용을 의미하지 않는다.",designStage:"SD",designCategory:"",projectApplication:"",notes:"미국 교통부(DOT) 규정 중 위험물(Hazardous Materials) 운송 관련 규정에서, Division 6.2 – Infectious Substances (감염성 물질)의 Category B 분류 기준과 포장 요건을 규정한 부분입니다."},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"COMBUSTIBLE LIQUID",titleKo:"가연성 액체",provisionEn:"A liquid having a closed cup flash point at or above 100°F (38°C). Combustible liquids shall be subdivided as follows: The category of combustible liquids does not include compressed gases or cryogenic fluids or liquids that do not have a fire point when tested in accordance with ASTM D92. Class II. Liquids having a closed cup flash point at or above 100°F (38°C) and below 140°F (60°C). Class IIIA. Liquids having a closed cup flash point at or above 140°F (60°C) and below 200°F (93°C). Class IIIB. Liquids having a closed cup flash point at or above 200°F (93°C).",provisionKo:"밀폐식 인화점이 100°F (38°C) 이상인 액체. 가연성 액체는 다음과 같이 분류된다. 가연성 액체 범주에는 압축가스나 극저온 유체 또는 ASTM D92에 따라 시험했을 때 연소점이 없는 액체는 포함되지 않는다. Class II (2급). 밀폐식 인화점이 100°F (38°C) 이상 140°F (60°C) 미만인 액체 Class IIIA (3A급). 밀폐식 인화점이140°F (60°C) 이상 200°F (93°C) 미만인 액체 Class IIIB (3B급). 밀폐식 인화점이 200°F (93°C) 이상인 액체",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"COMMON PATH OF EGRESS TRAVEL",titleKo:"공통 피난 경로",provisionEn:"That portion of exit access travel distance measured from the most remote point of each room, area or space to that point where the occupants have separate and distinct access to two exits or exit access doorways.",provisionKo:"각 실, 구역 또는 공간의 최원점(最遠點)에서 재실자가 두 개의 별개 출구 또는 비상구로 분리 및 구별되는 접근가능한 지점까지 측정된 비상구 접근 거리의 부분.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"EXIT ACCESS",titleKo:"피난통로 접근로",provisionEn:"That portion of a means of egress system that leads from any occupied portion of a building or structure to an exit.",provisionKo:"건물이나 구조물의 거주 부분에서 출구로 이어지는 피난수단시스템의 부분.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"EXIT ACCESS DOORWAY",titleKo:"비상문",provisionEn:"A door or access point along the path of egress travel from an occupied room, area or space where the path of egress enters an intervening room, corridor, exit access stairway or ramp.",provisionKo:"재실자가 있는 실, 구역 또는 공간에서 피난경로가 중간 실, 복도, 비상계단 또는 경사로로 이어지는 피난 경로상의 문 또는 접근지점.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"EXIT ACCESS STAIRWAY",titleKo:"비상계단",provisionEn:"A stairway within the exit access portion of the means of egress system.",provisionKo:"피난수단시스템의 비상 출구 접근부 내에 있는 계단.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"EXIT DISCHARGE",titleKo:"옥외로의 출구",provisionEn:"That portion of a means of egress system between the termination of an exit and a public way.",provisionKo:"출구의 종단과 공공도로 사이의 피난수단시스템 부분.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"EXIT PASSAGEWAY",titleKo:"피난복도",provisionEn:"An exit component that is separated from other interior spaces of a building or structure by fire-resistance-rated construction and opening protectives, and provides for a protected path of egress travel in a horizontal direction to an exit or to the exit discharge.",provisionKo:"내화구조와 개구부 방호장치에 의해 건물이나 구조물의 다른 내부공간과 분리되어 수평방향으로 출구 또는 옥외 출구로 향하는 보호된 피난보행경로를 제공하는 출구 구성요소.",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"EXPLOSION",titleKo:"폭발",provisionEn:"An effect produced by the sudden violent expansion of gases, which may be accompanied by a shock wave or disruption, or both, of enclosing materials or structures. An explosion could result from any of the following: 1. Chemical changes such as rapid oxidation, deflagration or detonation, decomposition of molecules and runaway polymerization (usually detonations). 2. Physical changes such as pressure tank ruptures. 3. Atomic changes (nuclear fission or fusion).",provisionKo:"가스의 급격하고 격렬한 팽창으로 발생하는 효과로 충격파나 둘러싼 자재 또는 구조물의 파괴, 또는 둘 다 수반할 수 있다. 폭발은 다음 중 어느 이유로도 발생할 수 있다. 1. 급속 산화, 폭연 또는 폭굉(Detonation), 분자 분해 및 폭주중합반응(일반적으로 폭굉)과 같은 화학적 변화. 2. 압력탱크 파열과 같은 물리적 변화. 3. 원자 변화(핵분열 또는 핵융합).",designStage:"SD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 2",section:"",subsection:"",titleEn:"EXPLOSIVE",titleKo:"폭발물",provisionEn:"A chemical compound, mixture or device, the primary or common purpose of which is to function by explosion. The term includes, but is not limited to: dynamite, black powder, pellet powder, initiating explosives, detonators, safety fuses, squibs, detonating cord, igniter cord, and igniters. The term \"explosive\" includes any material determined to be within the scope of USC Title 18: Chapter 40 and also includes any material classified as an explosive other than consumer fireworks, 1.4G by the hazardous materials regulations of DOTn 49 CFR Parts 100-185",provisionKo:"폭발에 의해 기능하는 것이 주요 또는 일반적 목적인 화합물, 혼합물 또는 장치. 이 용어는 다이너마이트, 흑색화약, 펠릿화약, 기폭약, 뇌관, 안전도화선, 폭관, 도폭선, 점화선 및 점화기를 포함하되 이에 국한되지 않는다. \"폭발물\"이라는 용어는 USC Title 18: Chapter 40의 적용범위에 해당하는 모든 물질을 포함하며, 소비자용 폭죽 (1.4G)을 제외하고 DOT 49 CFR Parts 100–185의 위험물질 규정에 의해 폭발물로 분류된 모든 물질을 포함한다.",designStage:"SD",designCategory:"",projectApplication:"",notes:"USC Title 18: Chapter 40, 미국 연방법 형법(Title 18)에서 폭발물(Explosives) 관련 범죄와 규제를 다루는 장. DOT 49 CFR Parts 100–185 미국 교통부(DOT)의 위험물 운송 규정(Hazardous Materials Regulations, HMR) 전 범위를 담고 있는 파트"},
  {chapter:"CHAPTER 3",section:"",subsection:"",titleEn:"Occupancy Classification and Use",titleKo:"",provisionEn:"",provisionKo:"Chapter 3는 건물 및 실 용도에 대한 구분입니다. IBC는 모든 규정의 시작이 건물 및 실의 용도 구분부터 시작합니다. IBC에서는 공통 사항들을 (General Requirements) 제외하고는 요구 사항들이 건물별 또는 실별의 용도로 구성되어 있습니다. 이에, 건물 및 실별의 용도를 정확히 구분하지 못하면 IBC 코드 분석이 잘못될 수 있고 설계 진행이 잘못된 방향으로 진행될 수 있습니다. 이에, 건물과 실의 용도를 명확히 구분하는 것이 IBC를 이해하고 분석하는데 있어서 선행되어야 할 중요한 사항입니다. 본 보고서에 기술되는 건물 및 실의 용도는 산업시설 건물에 주로 적용되는 Occupancy들로 제한합니다.",designStage:"DD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 3",section:"SECTION 304",subsection:"",titleEn:"BUSINESS GROUP B",titleKo:"업무시설군 B",provisionEn:"Business Group B occupancy includes, among others, the use of a building or structure, or a portion thereof, for office, professional or service-type transactions, including storage of records and accounts. Business occupancies shall include, but not be limited to, the following: Airport traffic control towers, Ambulatory care facilities, Animal hospitals, kennels and pounds, Banks, Barber and beauty shops, Car wash, Civic administration, Clinic, outpatient, Dry cleaning and laundries: pick-up and delivery stations and self-service, Educational occupancies for students above the 12th grade including higher education laboratories, Electronic data entry, Food processing establishments and commercial kitchens not associated with restaurants, cafeterias and similar dining facilities not more than 2,500 square feet (232 m2) in area, Laboratories: testing and research, Lithium-ion or lithium metal battery testing, research and development, Motor vehicle showrooms, Post offices, Print shops, Professional services (architects, attorneys, dentists, physicians, engineers, etc.), Radio and television stations, Telephone exchanges. Training and skill development not in a school or academic program (this shall include, but not be limited to, tutoring centers, martial arts studios, gymnastics and similar uses regardless of the ages served, and where not classified as a Group A occupancy)",provisionKo:"Business Group B occupancy (업무시설군 B 용도)는 특히 기록 및 장부의 보관을 포함하여 사무, 전문직 또는 서비스업 거래를 위한 건물이나 구조물 또는 그 일부의 사용을 포함한다. 업무시설은 다음을 포함하되 이에 국한되지 않는다. 공항 관제탑, 외래진료시설, 동물병원, 사육장, 보호소, 은행, 이미용실, 세차장, 시민행정시설, 외래진료소, 드라이클리닝 및 세탁소: 수거/배달 및 셀프서비스, 고등교육 실험실을 포함한 12학년 이상 학생을 위한 교육시설, 전자데이터 입력, 레스토랑/카페테리아 및 유사한 식당시설과 연관되지 않은 식품가공시설 및 상업용 주방(면적 2,500 sf (232m²) 이하), 시험 및 연구 실험실, 리튬이온 또는 리튬 금속 배터리 시험/연구개발, 자동차 전시장, 우체국, 인쇄소, 전문 서비스업(건축사, 변호사, 치과의사, 의사, 엔지니어 등), 라디오 및 텔레비전 방송국, 전화교환소. 학교나 학술 프로그램이 아닌 훈련 및 기능 개발(이는 서비스 대상 연령에 관계없이 학습지, 무술 스튜디오, 체조 및 유사한 용도를 포함하되 이에 국한되지 않으며, Group A 용도로 분류되지 않는 경우를 포함함).",designStage:"DD",designCategory:"Use & Occupancy",projectApplication:"GEORGIA",notes:"Group B Occupancy는 일반적으로 사무실 및 그와 유사한 기능을 가진 건물 및 실로 구분됨. Electronic data processing entry와 Lithium-ion or lithium metal battery testing, research and development은 2024 개정판에 추가됨."},
  {chapter:"CHAPTER 3",section:"SECTION 306",subsection:"SUB-SECTION306.1",titleEn:"FACTORY INDUSTRIAL GROUP F",titleKo:"공장산업시설군 F",provisionEn:"Factory Industrial Group F occupancy includes, among others, the use of a building or structure, or a portion thereof, for assembling, disassembling, fabricating, finishing, manufacturing, packaging, repair or processing operations that are not classified as a Group H hazardous or Group S storage occupancy.",provisionKo:"Factory Industrial Group F occupancy (공장산업시설군 F 용도)는 특히 Group H 위험시설 또는 Group S 저장시설 용도로 분류되지 않는 조립, 분해, 제작, 마무리, 제조, 포장, 수리 또는 가공 작업을 위한 건물이나 구조물 또는 그 일부의 사용을 포함한다.",designStage:"DD",designCategory:"Use & Occupancy",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"F Occupancy는 일반적으로 Group H (Hazardous) 또는 Group S (Storage)로 구분되지 않는, 공장 및 그와 유사한 기능을 가진 산업시설로 구분됨."},
  {chapter:"CHAPTER 3",section:"SECTION 306",subsection:"SUB-SECTION306.2",titleEn:"MODERATE-HAZARD FACTORY INDUSTRIAL, GROUP F-1",titleKo:"중위험 공장산업시설군 F-1",provisionEn:"Factory industrial uses that are not classified as Factory Industrial F-2 Low Hazard shall be classified as F-1 Moderate Hazard and shall include, but not be limited to, the following: Aircraft (manufacturing, not to include repair), Appliances, Athletic equipment, Automobiles and other motor vehicles, Bakeries, Beverages: over 20-percent alcohol content, Bicycles, Boats, Brooms or brushes, Business machines, Cameras and photo equipment, Canvas or similar fabric, Carpets and rugs (includes cleaning), Clothing, Construction and agricultural machinery, Disinfectants, Dry cleaning and dyeing, Electric generation plants, Electronics, Energy storage systems (ESS) in dedicated use buildings, Energy storage systems (ESS) and equipment containing lithium-ion or lithium metal batteries, Engines (including rebuilding), Food processing establishments and commercial kitchens not associated with restaurants, cafeterias and similar dining facilities more than 2,500 square feet (232 m2) in area, Furniture, Hemp products, Jute products, Laundries, Leather products, Lithium-ion batteries, Machinery, Metals, Millwork (sash and door), Motion pictures and television filming (without spectators), Musical instruments, Optical goods, Paper mills or products, Photographic film, Plastic products, Printing or publishing, Recreational vehicles, Refuse incineration, Shoes, Soaps and detergents, Textiles, Tobacco, Trailers, Upholstering, Vehicles powered by lithium-ion or lithium metal batteries, Water/sewer treatment facilities, Wood; distillation, Woodworking (cabinet)",provisionKo:"공장산업시설 F-2 Low Hazard (저위험군)으로 분류되지 않는 공장산업시설 용도는 F-1 Moderate Hazard (중위험군)으로 분류하며, 다음을 포함하되 이에 국한되지 않는다. 항공기(제조, 수리 제외), 가전제품, 운동장비, 자동차 및 기타 자동차, 제과점, 음료: 알콜 함량 20% 초과 주류(2024년 개정), 자전거, 보트, 빗자루 또는 솔, 사무용 기계, 카메라 및 사진장비, 캔버스 또는 유사한 직물, 카페트 및 러그(청소 포함), 의류, 건설 및 농업기계, 소독제, 드라이클리닝 및 염색, 발전소, 전자제품, 전용건물의 에너지저장시스템(ESS), 리튬이온 또는 리튬 금속 배터리를 포함한 에너지저장시스템(ESS) 및 장비, 엔진(리빌딩 포함), 레스토랑/카페테리아 및 유사한 식당시설과 연관되지 않은 식품가공시설 및 상업용 주방(면적 2,500 sq. ft (232m²) 초과), 가구, 대마제품, 황마제품, 세탁소, 가죽제품, 리튬이온 배터리, 기계류, 금속, 건축용 목공품(창틀 및 문), 영화 및 텔레비전 촬영(무관중), 악기, 광학용품, 제지공장 또는 제품, 사진필름, 플라스틱제품, 인쇄 또는 출판, 레저용 차량(RV), 폐기물 소각, 신발, 비누 및 세제, 직물, 담배, 트레일러, 실내장식업, 리튬이온 또는 리튬 금속 배터리로 구동되는 차량, 상하수도 처리시설, 목재; 증류, 목공(캐비닛)",designStage:"DD",designCategory:"Use & Occupancy",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"Energy storage systems (ESS) and equipment containing lithium-ion or lithium metal batteries, Lithium-ion batteries, Vehicles powered by lithium-ion or lithium metal batteries 등의 공장들은 최근과 향후의 산업의 동향 등을 반영하여 2024년 개정판에 추가됨."},
  {chapter:"CHAPTER 3",section:"SECTION 306",subsection:"SUB-SECTION306.3",titleEn:"Low-hazard factory industrial, Group F-2",titleKo:"저위험 공장산업시설군 F-2",provisionEn:"Factory industrial uses that involve the fabrication or manufacturing of noncombustible materials that during finishing, packing or processing do not involve a significant fire hazard shall be classified as Group F-2 occupancies and shall include, but not be limited to, the following: Beverages: up to and including 20-percent alcohol content, Brick and masonry, Ceramic products, Foundries Glass products, Gypsum, Ice, Metal products (fabrication and assembly)",provisionKo:"마무리, 포장 또는 가공 중에 상당한 화재 위험을 수반하지 않는 불연성 재료의 제작 또는 제조를 수반하는 공장산업시설 용도는 Group F-2로 분류하며, 다음을 포함하되 이에 국한되지 않는다. 음료: 알콜 함유량 20% 이하 주류(2024년 개정), 벽돌 및 조적, 세라믹제품, 주조공장 유리제품, 석고, 얼음, 금속제품(제작 및 조립)",designStage:"DD",designCategory:"Use & Occupancy",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"Group F-1보다 상대적으로 낮은 위험성을 가지고 있는 물질을 취급하거나 생산하는 산업시설."},
  {chapter:"CHAPTER 3",section:"SECTION 307",subsection:"SUB-SECTION307.1",titleEn:"High-hazard Group H",titleKo:"고위험시설군 H",provisionEn:"High-hazard Group H occupancy includes, among others, the use of a building or structure, or a portion thereof, that involves the manufacturing, processing, generation or storage of materials that constitute a physical or health hazard in quantities in excess of those allowed in control areas complying with Section 414, based on the maximum allowable quantity limits for control areas set forth in Tables 307.1(1) and 307.1(2). Hazardous occupancies are classified in Groups H-1, H-2, H-3, H-4 and H-5 and shall be in accordance with this section, the requirements of Section 415 and the International Fire Code. Hazardous materials stored or used on top of roofs or canopies shall be classified as rooftop storage or use and shall comply with the International Fire Code.",provisionKo:"고위험시설군 H 용도는 특히 Table 307.1(1) 및 307.1(2)에 명시된 관리구역의 최대 허용량에 기반하여 Section 414를 준수하는 관리구역의 허용량을 초과하는 물리적 또는 건강 위험을 초래하는 물질의 제조, 가공, 생성 또는 저장을 수반하는 건물이나 구조물 또는 그 일부의 사용을 포함한다. 위험시설은 Group H-1, H-2, H-3, H-4 및 H-5로 분류하며 본 조항, Section 415의 요구사항 및 IFC에 따라야 한다. 지붕이나 캐노피 상부에 저장 또는 사용되는 위험물질은 옥상 저장 또는 사용으로 분류하며 IFC를 준수해야 한다.",designStage:"DD",designCategory:"Use & Occupancy",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"H occupancy는 건물의 물리적 위험도나 사람의 건강에게 미치는 영향력이 상당히 커서 H occupancy를 저장, 가공, 생산, 및 취급하는 건물은 미 인허가청에서 다른 용도의 건물보다 상당히 관심있고 자세히 검토하는 분야입니다. International Fire Code (IFC)는, Chapter 50, Section 5001.5.1에서 Hazardous Material Management Plan (HMMP) 보고서와 Section 5001.5.2에서 Hazardous Material Inventory Statement (HMIS) 보고서를 요구하고 있습니다. 일반적으로, 위의 두가지 보고서는 chemical engineer나 위험물질 전문 code consultant가 수행합니다. 특히, Chemical Engineer나 위험물질 전문가로부터 프로젝트에서 취급하는 위험물질이 어떤 H occupancy인지 컨설팅을 받아야 합니다. (참조 본 보고서 Section 414.1.3) Table 307.1(1) and 307.1(2)에서 정하고 있는 위험물의 각 control area에서 취급 및 저장할 수 있는 최대 허용양을 초과하면 그 물질은 H occupancy로 규정됩니다. H occupancy는 그 위험도에 따라 H-1, H-2, H-3, H-4, 그리고 H-5로 구분되고, H-1이 가장 위험한 물질입니다. 프로젝트에서 취급하거나 저장하는 위험 물질이 Table 307.1(1) and 307.1(2)의 최대 허용량보다 적게 다루어지면 그 물질은 S Occupancy (Storage)로 구분됩니다. H occupancy는 Section 415와 International Fire Code에서 자세히 다룸."},
  {chapter:"CHAPTER 3",section:"SECTION 312",subsection:"SUB-SECTION312.1",titleEn:"Utility and Miscellaneous Group U",titleKo:"유틸리티 및 기타시설군 U",provisionEn:"Buildings and structures of an accessory character and miscellaneous structures not classified in any specific occupancy shall be constructed, equipped and maintained to conform to the requirements of this code commensurate with the fire and life hazard incidental to their occupancy. Group U shall include, but not be limited to, the following: Agricultural buildings, Aircraft hangars, accessory to a one- or two-family residence (see Section 412.4), Barns, Carports Communication equipment structures with a gross floor area of less than 1,500 square feet (139 m2), Fences more than 7 feet (2134 mm) in height, Grain silos, accessory to a residential occupancy, Livestock shelters, Private garages, Retaining walls, Sheds, Stables, Tanks, Towers",provisionKo:"부속적 성격의 건물 및 구조물과 특정 용도로 분류되지 않는 기타 구조물은 그 용도에 수반되는 화재 및 인명 위험에 상응하여 이 규정의 요구사항에 따라 건설, 설비 설치 및 유지되어야 한다. Group U는 다음을 포함하되 이에 국한되지 않는다: 농업건물, 1가구 또는 2가구 주택에 부속하는 항공기 격납고(Section 412.4 참조), 헛간, 카포트(Carport), 연면적 1,500 sq. ft (139m²) 미만인 통신장비 구조물, 높이7 ft (2,134mm) 초과 울타리, 주거 용도에 부속하는 곡물 사일로, 가축 보호소, 개인 차고, 옹벽, 창고, 마구간, 탱크, 타워",designStage:"DD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 4",section:"",subsection:"",titleEn:"Special Detailed Requirements based on Occupancy and Use",titleKo:"",provisionEn:"",provisionKo:"Chapter 4에서는 Chapter 3에서 구분된 용도를 더 세분화한 특별한 용도에 관해 기술하고 있습니다. 특히 산업시설에서 취급되는 위험물질과 H Occupancy는 건축 설계(면적, 높이, 구획 등의 제한)에 중대한 영향을 미칠 수 있어, 내용이 방대하고 복잡하지만 반드시 이해하고 숙지해야 할 사항입니다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"",notes:""},
  {chapter:"CHAPTER 4",section:"SECTION 403",subsection:"",titleEn:"High-rise Building",titleKo:"고층건물",provisionEn:"A building with an occupied floor or occupied roof located more than 75 feet (22,860 mm) above the lowest level of fire department vehicle access.",provisionKo:"소방차량 접근이 가능한 최하층으로부터 75피트(22,860mm) 초과 지점에 점유층 또는 점유옥상이 위치한 건물.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"일반적인 미국 소방 사다리차가 사다리를 펼쳐 호스에서 물을 뿌려 닿을 수 있는 최대 높이"},
  {chapter:"CHAPTER 4",section:"SECTION 403",subsection:"SUB-SECTION403.1",titleEn:"Applicability",titleKo:"적용성",provisionEn:"High-rise buildings shall comply with Sections 403.2 through 403.6. Exceptions: The provisions of Sections 403.2 through 403.6 shall not apply to the following buildings and structures: 1. Airport traffic control towers in accordance with Section 412.2. 2. Open parking garages in accordance with Section 406.5. 3. The portion of a building containing a Group A-5 occupancy in accordance with Section 303.6. 4. Special industrial occupancies in accordance with Section 503.1.1. 5. Buildings containing any one of the following: 5.1. A Group H-1 occupancy. 5.2. A Group H-2 occupancy in accordance with Section 415.8, 415.9.2, 415.9.3 or 426.1. 5.3. A Group H-3 occupancy in accordance with Section 415.8.",provisionKo:"고층건물은 Section 403.2 - 403.6을 준수해야 한다. 예외: Section 403.2 - 403.6의 규정은 다음 건물 및 구조물에는 적용되지 않는다. 1. Section 412.2에 따른 공항 관제탑 2. Section 406.5에 따른 개방형 주차장 3. Section 303.6에 따른 Group A-5 용도를 포함하는 건물 부분 4. Section 503.1.1에 따른 특수산업시설 용도 5. 다음 중 하나를 포함하는 건물: 5.1. Group H-1 용도 5.2. Section 415.8, 415.9.2, 415.9.3 또는 426.1에 따른 Group H-2 용도 5.3. Section 415.8에 따른 Group H-3 용도",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:""},
  {chapter:"CHAPTER 4",section:"SECTION 403",subsection:"SUB-SECTION403.2",titleEn:"Construction",titleKo:"구조",provisionEn:"The construction of high-rise buildings shall comply with the provisions of Sections 403.2.1 through 403.2.3. The fire-resistance rating reductions specified in Sections 403.2.1.1 and 403.2.1.2 shall be allowed in buildings that have sprinkler control valves equipped with supervisory initiating devices and water-flow initiating devices for each floor.",provisionKo:"고층건물의 구조는 Section 403.2.1 - 403.2.3의 규정을 준수해야 한다. 각 층에 감시기동장치(Supervisory initiating device)및 유수기동장치(Water-flow initiating device)가 장착된 스프링클러 제어밸브를 갖춘 건물에서는 Section 403.2.1.1 및 403.2.1.2에 명시된 내화등급 완화가 허용된다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:""},
  {chapter:"CHAPTER 4",section:"SECTION 403",subsection:"SUB-SECTION403.3",titleEn:"Automatic sprinkler system",titleKo:"자동스프링클러설비",provisionEn:"Buildings and structures shall be equipped throughout with an automatic sprinkler system in accordance with Section 903.3.1.1 and a secondary water supply where required by Section 403.3.3. Exception: An automatic sprinkler system shall not be required in spaces or areas of telecommunications equipment buildings used exclusively for telecommunications equipment, associated electrical power distribution equipment, batteries and standby engines, provided that those spaces or areas are equipped throughout with an automatic fire detection system in accordance with Section 907.2 and are separated from the remainder of the building by not less than 1-hour fire barriers constructed in accordance with Section 707 or not less than 2-hour horizontal assemblies constructed in accordance with Section 711, or both.",provisionKo:"건물 및 구조물에는 Section 903.3.1.1에 따라 자동스프링클러설비를 전체 설치해야 하며, Section 403.3.3에서 요구하는 경우 보조급수설비를 설치해야 한다. 예외: 통신장비, 관련 배전장비, 배터리 및 비상엔진 전용으로 사용되는 통신장비 건물의 공간이나 구역에서는 스프링클러설비가 요구되지 않는다. 단, 해당 공간이나 구역에는 Section 907.2에 따라 자동화재탐지설비를 전체에 설치하고, Section 707에 따라 시공된 1시간 이상의 방화구획 또는 Section 711에 따라 시공된 2시간 이상의 수평구조체, 또는 그 둘 다에 의해 건물의 나머지 부분과 분리되어야 한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:""},
  {chapter:"CHAPTER 4",section:"SECTION 413",subsection:"SUB-SECTION413.1",titleEn:"Combustible Storage",titleKo:"가연물 저장",provisionEn:"High-piled stock or rack storage in any occupancy group shall comply with the International Fire Code. Attic, under-floor and concealed spaces used for storage of combustible materials shall be protected on the storage side as required for 1-hour fire-resistance-rated construction. Openings shall be protected by assemblies that are self-closing and are of noncombustible construction or solid wood core not less than 1 3/4 inches (45 mm) in thickness.",provisionKo:"모든 용도군의 고적층 저장 또는 랙 저장은 IFC를 준수해야 한다. 가연물 저장용으로 사용되는 다락, 바닥 하부 및 은폐공간은 저장 측면이 1시간 내화등급 구조 요건에 맞춰 보호되어야 한다. 개구부는 자동 폐쇄되고 불연성 구조 또는 두께 1¾인치(45 mm) 이상의 원목 코어로 된 구조체로 보호되어야 한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"예외: 다음 장소에서는 내화 구조나 개구부 방호장치가 요구되지 않는다. 1. Areas protected by approved automatic sprinkler systems. 2. Group R-3 and U occupancies."},
  {chapter:"CHAPTER 4",section:"SECTION 414",subsection:"SUB-SECTION414.1",titleEn:"Hazardous Materials",titleKo:"위험물질",provisionEn:"Buildings and structures occupied for the manufacturing, processing, dispensing, use or storage of hazardous materials shall comply with Sections 414.1 through 414.6. Exception: Exemptions listed in Table 307.1.1 shall not be required to comply with Section 414.",provisionKo:"위험물질의 제조, 가공, 분배, 사용 또는 저장을 위해 사용되는 건물 및 구조물은 Section 414.1부터 414.6까지를 준수해야 한다. 예외: Table 307.1.1에 나열된 면제사항은 Section 414를 준수하지 않아도 된다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"허가권자에게 저장, 밀폐 시스템 및 개방 시스템에서 사용될 위험물질의 최대 예상량을 확인하는 보고서를 제출해야 하며, 관리구역, 화재방호시스템 및 Group H 용도를 포함하되 이에 국한되지 않는 위험에서 보호하는 방법을 보고서와 시공도서에 표시해야 한다."},
  {chapter:"CHAPTER 4",section:"SECTION 414",subsection:"SUB-SECTION414.2",titleEn:"Control Area",titleKo:"관리 구역",provisionEn:"Control area is spaces within a building where quantities of hazardous materials not exceeding the maximum allowable quantities per control area are stored, dispensed, used or handled. See the definition of \"Outdoor control area\" in the International Fire Code. Control areas shall be separated from each other by fire barriers constructed in accordance with Section 707 or horizontal assemblies constructed in accordance with Section 711, or both.",provisionKo:"관리구역은 건물 내에서 관리 구역당 최대 허용량을 초과하지 않는 범위의 위험물질을 저장, 분배, 사용 또는 취급하는 공간으로 정의된다. IFC의 \"Outdoor control area (실외 관리구역)\"을 참조한다. 관리구역은 Section 707에 따라 시공된 방화구획 또는 Section 711에 따라 시공된 수평구조체, 또는 그 둘 다에 의해 서로 분리되어야 한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"Table 414.2.2의 코드 의도는 위험물을 취급하는 건물을 H Occupancy로 구분하지 않고 Control Area를 이용해 건물에서 위험물질을 취급 저장하게 하는데 있습니다. 위험물을 Table 414.2.2에 따라 Control Area로 구획하면 건물을 H Occupancy로 구분하지 않아도 된다는 장점이 있습니다."},
  {chapter:"CHAPTER 4",section:"SECTION 414",subsection:"SUB-SECTION414.2.3",titleEn:"Number of control area",titleKo:"관리구역 개수",provisionEn:"The maximum number of control areas within a building shall be in accordance with Table 414.2.2. For the purposes of determining the number of control areas within a building, each portion of a building separated by one or more fire walls complying with Section 706 shall be considered a separate building.",provisionKo:"건물 내 관리구역의 최대 개수는 Table 414.2.2에 따라야 한다. 건물 내 관리구역 수를 결정하는 목적을 고려하여 Section 706을 준수하는 하나 이상의 방화벽으로 분리된 건물의 각 부분은 별도의 건물로 간주한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"예시: 10,000 평방 피트의 스프링클러가 설치되지 않은 1층의 F-1 Occupancy 공장에서 Class IB Flammable liquid를 H-2 Occupancy로 구분하지 않고 저장 및 취급할 수 있는 최대양. 건물을 방화벽으로 구획(control area)함으로 1. H Occupancy로 규정되지 않고 2. 스프링클러로 100% 증가 크레딧을 받고 3. 승인된 캐비닛으로 다시 100% 크레딧을 받음."},
  {chapter:"CHAPTER 4",section:"SECTION 414",subsection:"SUB-SECTION414.5.1",titleEn:"Explosion control requirements",titleKo:"폭발 제어 요구사항",provisionEn:"Explosion control shall be provided in accordance with the International Fire Code as required by Table 414.5.1 where quantities of hazardous materials specified in that table exceed the maximum allowable quantities in Table 307.1(1) or where a structure, room or space is occupied for purposes involving explosion hazards as required by Section 415 or the International Fire Code.",provisionKo:"Table 414.5.1에 명시된 위험물질양이 Table 307.1(1)의 최대 허용량을 초과하거나 구조물, 실 또는 공간이 Section 415 또는 IFC에서 요구하는 폭발 위험을 수반하는 목적으로 사용되는 경우, Table 414.5.1에 따라 IFC에 따라 폭발을 제어해야 한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"이 조항은 폭발에 의한 압력으로부터 건물을 보호하기 위한 조항임."},
  {chapter:"CHAPTER 4",section:"SECTION 415",subsection:"SUB-SECTION415.6",titleEn:"Fire Separation Distance",titleKo:"화재이격거리",provisionEn:"Group H occupancies shall be located on property in accordance with the other provisions of this chapter. In Groups H-2 and H-3, not less than 25 percent of the perimeter wall of the occupancy shall be an exterior wall.",provisionKo:"Group H 용도는 본 Chapter의 다른 규정에 따라 부지에 위치해야 한다. H-2 및 H-3에서는 용도의 둘레벽 중 최소 25%가 외벽이어야 한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"본 section은 한 건물안에 H Occupancy 물질을 저장하고 있는 공간에 대한 조항임. 소방관의 활동과 연소로 발생하는 물질 등의 환기를 위해, H-2 and H-3 저장공간은 외벽에 면해야 함."},
  {chapter:"CHAPTER 4",section:"SECTION 415",subsection:"SUB-SECTION415.7",titleEn:"Special provisions for Group H-1 occupancies",titleKo:"Group H-1 용도를 위한 특별 규정",provisionEn:"Group H-1 occupancies shall be in detached buildings not used for other purposes. Roofs shall be of lightweight construction with suitable thermal insulation to prevent sensitive material from reaching its decomposition temperature. Group H-1 occupancies containing materials that are in themselves both physical and health hazards in quantities exceeding the maximum allowable quantities per control area in Table 307.1(2) shall comply with requirements for both Group H-1 and H-4 occupancies.",provisionKo:"Group H-1 용도는 다른 목적으로 사용되지 않는 단독건물에 위치해야 한다. 지붕은 민감물질이 분해온도에 도달하는 것을 방지하기 위해 적절한 단열재를 갖춘 경량 구조여야 한다. Table 307.1(2)의 관리구역당 최대 허용량을 초과하는 양의 물리적 위험과 건강 위험을 모두 갖춘 물질을 포함하는 Group H-1 용도는 Group H-1 및 H-4용도의 요구사항을 모두 준수해야 한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:""},
  {chapter:"CHAPTER 4",section:"SECTION 415",subsection:"SUB-SECTION415.8",titleEn:"Special provisions for Group H-2 and H-3 occupancies",titleKo:"H-2 및 H-3 용도를 위한 특별 규정",provisionEn:"Group H-2 and H-3 occupancies containing quantities of hazardous materials in excess of those set forth in Table 415.6.5 shall be in detached buildings used for manufacturing, processing, dispensing, use or storage of hazardous materials. Materials specified for Group H-1 occupancies in Section 307.3 are permitted to be located within Group H-2 or H-3 detached buildings provided that the amount of materials per control area do not exceed the maximum allowed quantity specified in Table 307.1(1).",provisionKo:"Table 415.6.5에 명시된 양을 초과하는 위험물질을 포함하는 Group H-2 및 H-3 용도는 위험물질의 제조, 가공, 분배, 사용 또는 저장용으로 사용되는 단독건물에 위치해야 한다. Section 307.3에서 Group H-1 용도로 명시된 물질은 관리구역당 물질량이 Table 307.1(1)에 명시된 최대 허용량을 초과하지 않는 조건으로 Group H-2 또는 H-3 단독건물 내에 위치할 수 있다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:""},
  {chapter:"CHAPTER 4",section:"SECTION 415",subsection:"SUB-SECTION415.9",titleEn:"Special provisions for Group H-2 and H-3 occupancies",titleKo:"H-2 및 H-3 용도 - 인화성 액체",provisionEn:"The storage, handling, processing and transporting of flammable and combustible liquids in Group H-2 and H-3 occupancies shall be in accordance with Sections 415.9.1.1 through 415.9.1.9, the International Mechanical Code and the International Fire Code.",provisionKo:"Group H-2 및 H-3 용도의 인화성 및 가연성 액체의 저장, 취급, 가공 및 수송은 Section 415.9.1.1부터 415.9.1.9까지, International Mechanical Code 및 International Fire Code에 따라야 한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"저장탱크는 불연성이어야 하며 물리적 손상으로부터 보호되어야 한다. 저장된 액체와 상용성이 있는 액밀 격리 구역을 설치해야 한다."},
  {chapter:"CHAPTER 4",section:"SECTION 415",subsection:"SUB-SECTION415.10",titleEn:"Group H-3 and H-4",titleKo:"Group H-3 및 H-4",provisionEn:"Group H-3 occupancies shall comply with Section 415.9.1. Gas rooms shall be separated from other areas by not less than 1-hour fire barriers or horizontal assemblies. Floors in storage areas for corrosive liquids and highly toxic or toxic materials shall be of liquid-tight, noncombustible construction.",provisionKo:"Group H-3 용도의 인화성 및 가연성 액체는 Section 415.9.1에 따라야 한다. 가스실이 설치되는 경우 1시간 이상의 방화구획 또는 수평구조체에 의해 다른 구역과 분리되어야 한다. 부식성 액체 및 고독성 또는 독성 물질의 저장 구역 바닥은 액밀, 불연성 구조여야 한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"고독성 고체 및 액체는 승인된 위험물질 저장 캐비닛에 저장되지 않은 경우 1시간 이상의 방화구획에 의해 다른 위험물질로부터 격리되어야 한다."},
  {chapter:"CHAPTER 4",section:"SECTION 415",subsection:"SUB-SECTION415.11",titleEn:"Group H-5",titleKo:"Group H-5",provisionEn:"Fabrication areas shall comply with Sections 415.11.1.1 through 415.11.1.8. The aggregate quantities of hazardous materials stored and used in a single fabrication area shall not exceed the quantities set forth in Table 415.11.1.1. Fabrication areas shall be separated from each other, from corridors and from other parts of the building by not less than 1-hour fire barriers or horizontal assemblies.",provisionKo:"제조 구역은 Section 415.11.1.1부터 415.11.1.8까지를 준수해야 한다. 단일 제조 구역에 저장되고 사용되는 위험물질의 총량은 Table 415.11.1.1에 명시된 양을 초과해서는 안 된다. 제조 구역은 1시간 이상의 방화구획 또는 수평구조체에 의해 구역 간, 복도 및 건물의 다른 부분으로부터 분리되어야 한다.",designStage:"DD",designCategory:"구조/내화\n특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:"제조 구역의 거주층은 지반면 상부 1층 이상에 위치해야 한다. 바닥은 불연성 구조여야 하며, 용도 분리 부분의 바닥은 액밀이어야 한다. 서비스 복도는 시간당 최소 6회 기계 환기되어야 한다."},
  {chapter:"CHAPTER 5",section:"",subsection:"",titleEn:"GENERAL BUILDING HEIGHTS AND AREAS",titleKo:"일반 건물 높이 및 면적",provisionEn:"",provisionKo:"",designStage:"DD",designCategory:"특수시설/기타",projectApplication:"GEORGIA\nSPE 1\nSPE 2",notes:""},
  {chapter:"CHAPTER 6",section:"",subsection:"",titleEn:"TYPES OF CONSTRUCTION",titleKo:"건설 유형",provisionEn:"",provisionKo:"",designStage:"CD",designCategory:"구조/내화",projectApplication:"SPE 2",notes:""},
  {chapter:"CHAPTER 7",section:"",subsection:"",titleEn:"FIRE AND SMOKE PROTECTION FEATURES",titleKo:"화재 및 연기 방호 기능",provisionEn:"",provisionKo:"",designStage:"CD",designCategory:"구조/내화",projectApplication:"SPE 2",notes:""},
  {chapter:"CHAPTER 8",section:"",subsection:"",titleEn:"INTERIOR FINISHES",titleKo:"내부 마감",provisionEn:"",provisionKo:"",designStage:"CD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 9",section:"",subsection:"",titleEn:"FIRE PROTECTION AND LIFE SAFETY SYSTEMS",titleKo:"소방 및 인명안전 시스템",provisionEn:"",provisionKo:"",designStage:"CD",designCategory:"",projectApplication:"",notes:""},
  {chapter:"CHAPTER 10",section:"",subsection:"",titleEn:"MEANS OF EGRESS",titleKo:"피난수단",provisionEn:"",provisionKo:"",designStage:"CD",designCategory:"피난 계획",projectApplication:"SPE 2",notes:""},
  {chapter:"CHAPTER 29",section:"",subsection:"",titleEn:"PLUMBING SYSTEMS",titleKo:"배관 시스템",provisionEn:"",provisionKo:"",designStage:"CD",designCategory:"특수시설/기타",projectApplication:"SPE 2",notes:""}
];


    /* =========================
       STATE
       ========================= */
    let currentPage = 1;
    const itemsPerPage = 5;
    let filteredData = [];
    let allData = ibcData;
    let currentSearchResults = [];
    let lastSearchTerm = '';
    let isListMode = false;

    const bookmarks = new Set();
    window.__popupCtx = null;
    window.__popupRelated = [];
    let recentSearches = [];
    let scrollBound = false;

    /* =========================
       INIT
       ========================= */
    document.addEventListener('DOMContentLoaded', function(){
      initializeMenus();
      populateFilterCategories();
      setupEventListeners();
      filteredData = allData;
      displayResults(allData);
    });

    /* =========================
       HELPERS
       ========================= */
    function splitMultiline(str){
      return (str || '')
        .split('\n')
        .map(s=>s.trim())
        .filter(Boolean);
    }
    function getUniqueCategories(){
      const raw = allData
        .map(i => i?.designCategory || '')
        .flatMap(c => splitMultiline(c));
      return [...new Set(raw)];
    }
    function escapeRegExp(s){return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');}
    function highlightTerm(text, term){
      if (!term) return text || '';
      const re = new RegExp(escapeRegExp(term), 'gi');
      return (text || '').replace(re, m=>`<mark>${m}</mark>`);
    }
    function toUpperDisplay(s){ return (s||'').toUpperCase(); }

    function normalize(str){
      return String(str||'')
        .toLowerCase()
        .replace(/[\u2010-\u2015\u2212]/g,'-')  // 다양한 대시 → 하이픈
        .replace(/[-/]+/g,' ')                  // 구분자 통일
        .replace(/\s+/g,' ')
        .trim();
    }
    function lightStem(w){
      if (w.length <= 3) return w;
      let s = w;
      s = s.replace(/(ing|ers|ies|sses|s|ed)$/,''); // 가벼운 스테밍
      return s || w;
    }
    function parseQuery(q){
      const norm = normalize(q);
      const phrases = [];
      const tokens = [];
      norm.replace(/"([^"]+)"/g, (_,p)=>{ phrases.push(p.trim()); return ''; });
      const rest = norm.replace(/"[^"]+"/g,' ').trim();
      rest.split(/[\s,;:/|]+/).filter(Boolean).forEach(t=>tokens.push(t));
      return { phrases, tokens };
    }
    function wordBoundaryHas(hay, needle){
      const re = new RegExp(`(^|[^a-z0-9_])${escapeRegExp(needle)}([^a-z0-9_]|$)`,'i');
      return re.test(hay);
    }
    function scoreItem(item, query){
      const { phrases, tokens } = parseQuery(query);
      const fields = [
        {v:item.titleEn, w:4},
        {v:item.titleKo, w:3},
        {v:item.provisionEn, w:3},
        {v:item.provisionKo, w:2},
        {v:item.chapter, w:1.5},
        {v:item.section, w:1.5},
        {v:item.subsection, w:1.5},
        {v:item.notes, w:1}  // ✅ Notes도 검색에는 반영
      ];
      let score = 0;
      let matched = false;

      // 구문(따옴표) 가산
      for (const ph of phrases){
        const phn = normalize(ph);
        const phStemmed = phn.split(' ').map(lightStem).join(' ');
        for (const f of fields){
          const val = normalize(f.v||'');
          if (!val) continue;
          if (val.includes(phn) || val.includes(phStemmed)){
            score += 10 * f.w;
            matched = true;
          }
        }
      }

      // 토큰: 모두 일치(AND), 경계 기반
      let allTokensOk = true;
      for (const tk of tokens){
        const stem = lightStem(tk);
        let tokenMatched = false;
        for (const f of fields){
          const val = normalize(f.v||'');
          if (!val) continue;
          const hit =
            (tk.length >= 3 ? (wordBoundaryHas(val, tk) || wordBoundaryHas(val, stem)) : val.includes(tk));
          if (hit){
            score += 1.2 * f.w;
            tokenMatched = true;
          }
        }
        if (!tokenMatched){ allTokensOk = false; break; }
      }

      if (!phrases.length && !tokens.length) return {matched:false, score:0};
      return { matched: (matched || allTokensOk), score };
    }

    function getItemId(item){
      return [item.chapter,item.section,item.subsection,item.titleEn].join('|');
    }
    function formatResultSectionDisplay(chapter, section, subsection){
      let out = [];
      if (chapter){
        const cm = String(chapter).match(/CHAPTER\s+(\d+)/i);
        out.push(cm ? `CHAPTER ${cm[1]}` : (String(chapter).trim().toUpperCase().startsWith('CHAPTER') ? String(chapter).trim() : `CHAPTER ${String(chapter).trim()}`));
      }
      const secMatch = section && String(section).match(/SECTION\s+(\d+(?:\.\d+)*)/i);
      const subMatch = subsection && String(subsection).match(/SUB[\s-]?SECTION\s*(\d+(?:\.\d+)*)/i);
      if (subMatch){ out.push(`SECTION ${subMatch[1]}`); }
      else if (secMatch){ out.push(`SECTION ${secMatch[1]}`); }
      const result = out.join(' ');
      return lastSearchTerm ? highlightTerm(result,lastSearchTerm) : result;
    }
    function formatPopupSectionDisplay(chapter, section, subsection){
      let result = '';
      if (chapter && /CHAPTER/i.test(chapter)){
        const cm = String(chapter).match(/CHAPTER\s+(\d+)/i);
        result += cm ? `CHAPTER ${cm[1]}` : String(chapter).trim();
      } else if (chapter){ result += String(chapter).trim(); }
      const secMatch = section && String(section).match(/SECTION\s+(\d+(?:\.\d+)*)/i);
      const subMatch = subsection && String(subsection).match(/SUB[\s-]?SECTION\s*(\d+(?:\.\d+)*)/i);
      if (secMatch){
        result += (result ? ' ' : '') + `SECTION ${secMatch[1]}`;
        if (subMatch){
          result = result.replace(/SECTION\s+\d+(?:\.\d+)*(?=$|)/i, `SECTION ${subMatch[1]}`);
        }
      } else if (subMatch){
        result += (result ? ' ' : '') + `SECTION ${subMatch[1]}`;
      }
      return result;
    }
    function groupBy(array, key){
      return array.reduce((res, cur) => {
        (res[cur[key]] = res[cur[key]] || []).push(cur);
        return res;
      }, {});
    }
    function clearActiveMenuItems(){document.querySelectorAll('.menu-item.active').forEach(i=>i.classList.remove('active'));}
    function setActive(el){clearActiveMenuItems(); if (el) el.classList.add('active');}

    function showMiniToast(containerOrBtn, text='Copied!'){
      const host = containerOrBtn.closest ? containerOrBtn.closest('.result-item, .bookmark-panel, .popup-content') : containerOrBtn;
      const badge = document.createElement('div');
      badge.className='toast';
      badge.textContent=text;
      host.appendChild(badge);
      requestAnimationFrame(()=>badge.classList.add('show'));
      setTimeout(()=>{badge.classList.remove('show'); setTimeout(()=>badge.remove(),200)},1200);
    }

    /* =========================
       MENUS
       ========================= */
    function initializeMenus(){
      const chaptersMenu = document.getElementById('chaptersMenu');

      // 최상단 OVERVIEW
      const overviewWrap = document.createElement('div');
      overviewWrap.innerHTML = `
        <div class="menu-item" onclick="filterOverview(this)">
          <span class="chapter-text">OVERVIEW</span>
        </div>
      `;
      chaptersMenu.appendChild(overviewWrap);

      // Chapters
      const chapters = [...new Set(
        (allData || [])
          .map(i => i && i.chapter ? String(i.chapter).trim() : '')
          .filter(Boolean)
      )].sort((a,b)=>{
        const an = (a.match(/\d+/) || [0])[0]*1;
        const bn = (b.match(/\d+/) || [0])[0]*1;
        return an - bn || a.localeCompare(b);
      });

      chapters.forEach(chapter => {
        const sections = (allData || []).filter(i => (i && String(i.chapter).trim() === chapter));
        const sectionGroups = groupBy(
          sections.filter(x => x && x.section && String(x.section).trim()),
          'section'
        );

        const chapId = `chapter-${chapter.replace(/\s+/g,'')}`;
        const safeChap = chapter
          .replace(/["']/g, m => m === '"' ? '&quot;' : '&#39;')
          .replace(/`/g, '&#96;')
          .replace(/\n/g,' ');

        const wrapper = document.createElement('div');
        wrapper.innerHTML = `
          <div class="menu-item" onclick="toggleChapterAndFilter('${safeChap}','${chapId}', this)">
            <span class="chapter-text">${chapter}</span>
          </div>
          <div class="submenu" id="${chapId}">
            ${
              Object.keys(sectionGroups)
                .sort((a,b)=>{
                  const ax = (String(a).match(/\d+(?:\.\d+)*/)||[''])[0];
                  const bx = (String(b).match(/\d+(?:\.\d+)*/)||[''])[0];
                  const an = ax.split('.').map(n=>+n);
                  const bn = bx.split('.').map(n=>+n);
                  for (let i=0; i<Math.max(an.length,bn.length); i++){
                    const d = (an[i]||0)-(bn[i]||0);
                    if (d) return d;
                  }
                  return String(a).localeCompare(String(b));
                })
                .map(section=>{
                  const safe = String(section)
                    .replace(/["']/g, m => m === '"' ? '&quot;' : '&#39;')
                    .replace(/`/g, '&#96;')
                    .replace(/\n/g,' ');
                  return `
                    <div class="menu-item" style="margin-left:1rem;" onclick="filterBySection('${safe}', this)">
                      ${section}
                    </div>
                  `;
                }).join('')
            }
          </div>
        `;
        chaptersMenu.appendChild(wrapper);
      });

      // fold/unfold top-level
      document.querySelectorAll('.menu-title').forEach(title=>{
        const targetId = title.getAttribute('data-target');
        const content = document.getElementById(targetId);
        if (!content) return;
        content.classList.remove('show');
        title.addEventListener('click', ()=>{
          const isOpen = content.classList.contains('show');
          document.querySelectorAll('.menu-content').forEach(c=>c.classList.remove('show'));
          if (!isOpen) content.classList.add('show');
        });
      });

      // Design Stages
      const stageSet = [...new Set(
        (allData || [])
          .map(i => i && i.designStage ? String(i.designStage).trim() : '')
          .filter(Boolean)
      )];
      const designStagesMenu = document.getElementById('designStagesMenu');
      stageSet.forEach(stage=>{
        const div = document.createElement('div');
        div.className = 'menu-item';
        div.textContent = stage;
        div.onclick = (e)=>filterByDesignStage(stage, e.currentTarget);
        designStagesMenu.appendChild(div);
      });

      // Design Categories
      const categories = getUniqueCategories();
      const designCategoriesMenu = document.getElementById('designCategoriesMenu');
      categories.forEach(cat=>{
        const div = document.createElement('div');
        div.className = 'menu-item';
        div.textContent = cat;
        div.onclick = (e)=>filterByDesignCategory(cat, e.currentTarget);
        designCategoriesMenu.appendChild(div);
      });

      // Project Application
      const projectApplicationMenu = document.getElementById('projectApplicationMenu');
      ["GEORGIA","SPE 1","SPE 2"].forEach(p=>{
        const div = document.createElement('div');
        div.className = 'menu-item';
        div.textContent = p;
        div.onclick = (e)=>filterByProjectApplication(p, e.currentTarget);
        projectApplicationMenu.appendChild(div);
      });
    }

    function toggleChapterAndFilter(chapter, submenuId, el){
      filterByChapter(chapter, el);
      const submenu = document.getElementById(submenuId);
      const willOpen = !submenu.classList.contains('show');
      document.querySelectorAll('#chaptersMenu .submenu').forEach(s=>s.classList.remove('show'));
      if (willOpen) submenu.classList.add('show');
    }

    /* =========================
       FILTER PANEL
       ========================= */
    function populateFilterCategories(){
      const container = document.getElementById('categoriesOptions');
      container.innerHTML = '';
      getUniqueCategories().forEach(cat=>{
        const id = 'cat_' + cat.trim().toLowerCase().replace(/\s+/g,'_').replace(/[^a-z0-9_\-]/g,'_');
        const row = document.createElement('div');
        row.className = 'filter-option';
        row.innerHTML = `<input type="checkbox" id="${id}" value="${cat}"/> ${cat}`;
        container.appendChild(row);
      });
    }

    /* =========================
       RENDER
       ========================= */
    function renderTextWithHighlight(text){ return lastSearchTerm ? highlightTerm(text, lastSearchTerm) : (text || ''); }

    function displayResults(data){
      const container = document.getElementById('resultsContainer');
      const scrollBtn = document.getElementById('scrollTop'); // 기존 버튼 보존
      const startIndex = (currentPage - 1)*itemsPerPage;
      const pageData = data.slice(startIndex, startIndex+itemsPerPage);

      if (pageData.length === 0){
        container.innerHTML = `
          <div class="no-results">
            <h3>No Results Found</h3>
            <p>Try adjusting your search terms or browse the menu</p>
          </div>`;
        container.appendChild(scrollBtn);
        document.getElementById('pagination').style.display = 'none';
        bindScrollBtn();
        return;
      }

      let html = '';
      if (isListMode){
        // 리스트 모드
        html = pageData.map((item, idx)=>{
          const globalIndex = startIndex + idx;
          const tEn = renderTextWithHighlight(item.titleEn || '');
          const tKo = renderTextWithHighlight(item.titleKo || '');
          const pEn = renderTextWithHighlight(item.provisionEn || '');
          const pKo = renderTextWithHighlight(item.provisionKo || '');
          const notes = item.notes ? renderTextWithHighlight(item.notes) : '';
          const id = getItemId(item);
          const isBookmarked = bookmarks.has(id);

          const projectTags = splitMultiline(item.projectApplication).map(p =>
            `<span class="keyword" onclick="showKeywordPopup('projectApplication','${p.replace(/'/g,'&#39;')}')">${p}</span>`).join('');
          const categoryTags = splitMultiline(item.designCategory).map(c =>
            `<span class="keyword" onclick="showKeywordPopup('designCategory','${c.replace(/'/g,'&#39;')}')">${c}</span>`).join('');
          const stageTag = item.designStage ? `<span class="keyword" onclick="showKeywordPopup('designStage','${item.designStage.replace(/'/g,'&#39;')}')">${item.designStage}</span>` : '';

          return `
            <div class="list-item">
              <div class="list-header" onclick="toggleListItem(this)">
                <div class="list-titles">
                  <span class="list-num">${formatResultSectionDisplay(item.chapter,item.section,item.subsection)}</span>
                  ${tEn ? `<span class="list-en">${tEn}</span>`:''}
                  ${tKo ? `<span class="list-ko"><em>${tKo}</em></span>`:''}
                </div>
                <svg class="chev" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                     viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                     stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
              </div>
              <div class="list-content">
                <div class="result-item" style="border:none;padding:0;">
                  <button class="copy-btn" title="Copy provision" onclick="copyProvision(${globalIndex}, this); event.stopPropagation();">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round">
                      <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                      <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                    </svg>
                  </button>
                  <button class="bookmark-btn ${isBookmarked?'active':''}" title="Bookmark"
                          onclick="toggleBookmark('${id}', ${globalIndex}); event.stopPropagation();">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round">
                      <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/>
                    </svg>
                  </button>

                  <div class="provision-number">
                    ${formatResultSectionDisplay(item.chapter,item.section,item.subsection)}
                  </div>

                  <div class="content-section">
                    ${pEn ? `<div class="content-en">${pEn}</div>` : ''}
                    ${pKo ? `<div class="content-ko">${pKo}</div>` : ''}
                    ${notes ? `<div class="notes">${notes}</div>` : ''} <!-- ✅ Notes 표시 -->
                  </div>

                  <div class="keywords">
                    ${stageTag}${categoryTags}${projectTags}
                  </div>
                </div>
              </div>
            </div>`;
        }).join('');
      } else {
        // 카드 모드
        html = pageData.map((item, idx)=>{
          const globalIndex = startIndex + idx;
          const projectTags = splitMultiline(item.projectApplication).map(p =>
            `<span class="keyword" onclick="showKeywordPopup('projectApplication','${p.replace(/'/g,'&#39;')}')">${p}</span>`
          ).join('');
          const categoryTags = splitMultiline(item.designCategory).map(c =>
            `<span class="keyword" onclick="showKeywordPopup('designCategory','${c.replace(/'/g,'&#39;')}')">${c}</span>`
          ).join('');

          const tEn = renderTextWithHighlight(item.titleEn || '');
          const tKo = renderTextWithHighlight(item.titleKo || '');
          const pEn = renderTextWithHighlight(item.provisionEn || '');
          const pKo = renderTextWithHighlight(item.provisionKo || '');
          const notes = item.notes ? renderTextWithHighlight(item.notes) : '';

          const id = getItemId(item);
          const isBookmarked = bookmarks.has(id);

          return `
          <div class="result-item">
            <button class="copy-btn" title="Copy provision" onclick="copyProvision(${globalIndex}, this)">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round">
                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
              </svg>
            </button>
            <button class="bookmark-btn ${isBookmarked?'active':''}" title="Bookmark"
                    onclick="toggleBookmark('${id}', ${globalIndex})">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round">
                <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/>
              </svg>
            </button>

            <div class="provision-number">
              ${formatResultSectionDisplay(item.chapter,item.section,item.subsection)}
            </div>

            <div class="title-section">
              ${tEn ? `<div class="title-en">${tEn}</div>` : ''}
              ${tKo ? `<div class="title-ko"><em>${tKo}</em></div>` : ''}
            </div>

            <div class="content-section">
              ${pEn ? `<div class="content-en">${pEn}</div>` : ''}
              ${pKo ? `<div class="content-ko">${pKo}</div>` : ''}
              ${notes ? `<div class="notes">${notes}</div>` : ''} <!-- ✅ Notes 표시 -->
            </div>

            <div class="keywords">
              ${item.designStage ? `<span class="keyword" onclick="showKeywordPopup('designStage','${item.designStage.replace(/'/g,'&#39;')}')">${item.designStage}</span>` : ''}
              ${categoryTags}
              ${projectTags}
            </div>
          </div>`;
        }).join('');
      }

      container.innerHTML = html;
      container.appendChild(scrollBtn);
      updatePagination(data.length);
      bindScrollBtn();
    }

    function bindScrollBtn(){
      if (scrollBound) return;
      scrollBound = true;
      const scrollTopBtn = document.getElementById('scrollTop');
      const mainContent = document.querySelector('.main-content');
      if (!scrollTopBtn) return;
      mainContent.addEventListener('scroll', function(){
        scrollTopBtn.style.display = (this.scrollTop > 300) ? 'flex' : 'none';
      });
      scrollTopBtn.addEventListener('click', ()=> mainContent.scrollTo({top:0,behavior:'smooth'}));
    }

    function updatePagination(totalItems){
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      const pagination = document.getElementById('pagination');
      if (totalPages <= 1){ pagination.style.display = 'none'; return; }
      pagination.style.display = 'flex';

      let buttons = `
        <button class="page-btn" onclick="goToPage(1)" ${currentPage===1?'disabled':''}>&laquo;</button>
        <button class="page-btn" onclick="goToPage(${currentPage-1})" ${currentPage===1?'disabled':''}>&lsaquo;</button>
      `;
      const windowSize = 5;
      let start = Math.max(1, currentPage - Math.floor(windowSize/2));
      let end = Math.min(totalPages, start + windowSize - 1);
      if (end - start + 1 < windowSize){
        start = Math.max(1, end - windowSize + 1);
      }
      for (let p=start; p<=end; p++){
        buttons += `<button class="page-btn ${p===currentPage?'active':''}" onclick="goToPage(${p})">${p}</button>`;
      }
      buttons += `
        <button class="page-btn" onclick="goToPage(${currentPage+1})" ${currentPage===totalPages?'disabled':''}>&rsaquo;</button>
        <button class="page-btn" onclick="goToPage(${totalPages})" ${currentPage===totalPages?'disabled':''}>&raquo;</button>
      `;
      pagination.innerHTML = buttons;
    }
    function goToPage(page){
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      if (page>=1 && page<=totalPages){
        currentPage = page;
        displayResults(filteredData);
        document.querySelector('.main-content').scrollTo({top:0,behavior:'smooth'});
      }
    }

    /* =========================
       COPY (single) — Notes 제외
       ========================= */
    function buildCopyText(item){
      const header = formatPopupSectionDisplay(item.chapter,item.section,item.subsection);
      const lines = [
        header,
        toUpperDisplay(item.titleEn || ''),
        item.titleKo || '',
        item.provisionEn || '',
        item.provisionKo || ''
        // Notes는 복사 제외
      ].filter(Boolean);
      return `── ${header} ──\n` + lines.slice(1).join('\n\n');
    }
    async function copyProvision(globalIndex, btn){
      const item = filteredData[globalIndex];
      if (!item) return;
      const text = buildCopyText(item);
      try{
        if (navigator.clipboard?.writeText){
          await navigator.clipboard.writeText(text);
        } else {
          const ta = document.createElement('textarea');
          ta.value = text; document.body.appendChild(ta);
          ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        }
        showMiniToast(btn);
      }catch(e){ console.error('Copy failed', e); }
    }

    /* =========================
       LIST MODE TOGGLE
       ========================= */
    function toggleListItem(headerEl){
      const parent = headerEl.closest('.list-item');
      parent.classList.toggle('open');
    }
    function toggleViewMode(){
      isListMode = !isListMode;
      const btn = document.getElementById('viewToggle');
      btn.innerHTML = isListMode
        ? `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
             <path d="M3 5h8"/><path d="M3 12h8"/><path d="M3 19h8"/><path d="m15 8 3-3 3 3"/><path d="m15 16 3 3 3-3"/>
           </svg>`
        : `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
             <path d="M3 5h8"/><path d="M3 12h8"/><path d="M3 19h8"/><path d="m15 5 3 3 3-3"/><path d="m15 19 3-3 3 3"/>
           </svg>`;
      displayResults(filteredData);
    }

    /* =========================
       BOOKMARK
       ========================= */
    function toggleBookmark(id, globalIndex){
      if (bookmarks.has(id)) bookmarks.delete(id);
      else bookmarks.add(id);

      displayResults(filteredData);
      if (bookmarks.size === 0) {
        closeBookmarkPanel();
      } else {
        openBookmarkPanel(true);
      }
    }

    function openBookmarkPanel(stickyOpen=false){
      const panel = document.getElementById('bookmarkPanel');
      const handle = document.getElementById('bmHandle');

      if (bookmarks.size === 0){
        panel.style.display = 'none';
        handle.style.display = 'none';
        return;
      }
      renderBookmarkList();
      panel.style.display = 'block';
      handle.style.display = 'flex';

      if (!panel.style.left){
        const pw = panel.getBoundingClientRect().width || 360;
        const margin = 16;
        const left = Math.max(350 + 8, window.innerWidth - pw - margin);
        panel.style.left = left + 'px';
        updateHandlePosition();
      }
      if (stickyOpen){ panel.classList.remove('collapsed'); handle.querySelector('span').textContent = '<'; }
    }
    function closeBookmarkPanel(){
      const panel = document.getElementById('bookmarkPanel');
      const handle = document.getElementById('bmHandle');
      panel.style.display='none';
      handle.style.display='none';
    }

    function renderBookmarkList(){
      const listEl = document.getElementById('bookmarkList');
      const items = allData.filter(item => bookmarks.has(getItemId(item)));
      if (!items.length){
        closeBookmarkPanel();
        return;
      }
      listEl.innerHTML = items.map((item,i)=>{
        const id = getItemId(item);
        const title = (item.titleEn || item.titleKo || formatPopupSectionDisplay(item.chapter,item.section,item.subsection) || 'Untitled');
        return `
          <div class="bm-row">
            <input type="checkbox" class="bm-check" data-id="${id}" checked />
            <div class="bm-title">${toUpperDisplay(title)}</div>
          </div>`;
      }).join('');

      listEl.querySelectorAll('.bm-check').forEach(cb=>{
        cb.addEventListener('change', (e)=>{
          const id = e.target.getAttribute('data-id');
          if (!e.target.checked){
            bookmarks.delete(id);
            renderBookmarkList();
            displayResults(filteredData);
          }
        });
      });
    }

    function getSelectedBookmarkItems(){
      const checks = Array.from(document.querySelectorAll('.bm-check'));
      const selectedIds = checks.filter(c=>c.checked).map(c=>c.getAttribute('data-id'));
      const items = allData.filter(item => selectedIds.includes(getItemId(item)));
      if (!items.length){
        return allData.filter(item => bookmarks.has(getItemId(item)));
      }
      return items;
    }

    // Panel COPY — Notes 제외
    async function copySelectedBookmarks(){
      const items = getSelectedBookmarkItems();
      if (!items.length) return;
      const text = items.map(buildCopyText).join('\n\n——————\n\n');
      try{
        if (navigator.clipboard?.writeText) await navigator.clipboard.writeText(text);
        else {
          const ta = document.createElement('textarea'); ta.value=text; document.body.appendChild(ta);
          ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        }
        showMiniToast(document.getElementById('bookmarkPanel'));
      }catch(e){ console.error(e); }
    }

    // Panel PRINT — Notes 제외
    function printSelectedBookmarks(){
      const items = getSelectedBookmarkItems();
      if (!items.length) return;
      const html = `
        <div class="print-scope">
          <h2>Bookmarks</h2>
          ${items.map(it=>{
            const head = formatPopupSectionDisplay(it.chapter,it.section,it.subsection);
            const tEn = toUpperDisplay(it.titleEn || '');
            const tKo = it.titleKo || '';
            const pEn = it.provisionEn || '';
            const pKo = it.provisionKo || '';
            return `
              <div class="print-item">
                <h3>${head}</h3>
                ${tEn ? `<div><strong>${tEn}</strong></div>`:''}
                ${tKo ? `<div class="muted"><em>${tKo}</em></div>`:''}
                ${pEn ? `<div style="margin-top:6px;line-height:1.7">${pEn}</div>`:''}
                ${pKo ? `<div style="margin-top:6px;color:#333;line-height:1.6">${pKo}</div>`:''}
              </div>
            `;
          }).join('')}
        </div>`;
      const win = window.open('', '_blank', 'width=900,height=1000');
      win.document.write(`<!doctype html><html><head><title>Bookmarks</title>
        <style>
          body{font-family:Helvetica, Arial, sans-serif;}
          .print-scope{padding:24px}
          .print-item{margin:12px 0;padding:12px;border-top:1px solid #ddd}
          .muted{color:#666}
        </style>
      </head><body>${html}<script>window.onload=()=>window.print();<\/script></body></html>`);
      win.document.close();
    }

    /* =========================
       BOOKMARK PANEL DRAGGING
       ========================= */
    (function enableBookmarkDragging(){
      const panel = document.getElementById('bookmarkPanel');
      const header = document.getElementById('bookmarkHeader');
      const handle = document.getElementById('bmHandle');
      let isDragging=false, startX=0, startY=0, origLeft=0, origTop=0;

      function clamp(val, min, max){ return Math.max(min, Math.min(max, val)); }
      function onMouseDown(e){
        if (panel.style.display==='none') return;
        isDragging=true;
        const rect = panel.getBoundingClientRect();
        startX = e.clientX; startY = e.clientY;
        origLeft = rect.left; origTop = rect.top;
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
        e.preventDefault();
      }
      function onMouseMove(e){
        if (!isDragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        const pw = panel.getBoundingClientRect().width;
        const ph = panel.getBoundingClientRect().height;

        const minLeft = 350 + 8;
        const maxLeft = window.innerWidth - pw - 8;
        const minTop  = 90;
        const maxTop  = window.innerHeight - ph - 8;

        const newLeft = clamp(origLeft + dx, minLeft, maxLeft);
        const newTop  = clamp(origTop + dy,  minTop,  maxTop);

        panel.style.left = newLeft + 'px';
        panel.style.top  = newTop + 'px';
        updateHandlePosition();
      }
      function onMouseUp(){
        isDragging=false;
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      }
      header.addEventListener('mousedown', onMouseDown);

      window.updateHandlePosition = function(){
        const r = panel.getBoundingClientRect();
        handle.style.top  = r.top + 'px';
        handle.style.left = (r.left - 28) + 'px';
      };
      document.getElementById('bmHandle').addEventListener('click', ()=>{
        const collapsed = panel.classList.toggle('collapsed');
        document.getElementById('bmHandle').querySelector('span').textContent = collapsed ? '>' : '<';
        updateHandlePosition();
      });
      window.addEventListener('resize', ()=>{ if (panel.style.display!=='none') updateHandlePosition(); });
    })();

    /* =========================
       POPUP (Keyword) — Notes 표시하지 않음
       ========================= */
    function showKeywordPopup(type, value){
      window.__popupCtx = { type, value };
      const relatedData = allData.filter(item=>{
        if (type==='designCategory'){
          return splitMultiline(item.designCategory).includes(value);
        } else if (type==='projectApplication'){
          return splitMultiline(item.projectApplication).includes(value);
        } else {
          return item[type] === value;
        }
      });
      window.__popupRelated = relatedData;
      const popup = document.getElementById('popup');
      popup.style.display = 'flex';
      renderPopupList();
    }

    function renderPopupList(){
      const { type, value } = window.__popupCtx || {type:'', value:''};
      const relatedData = window.__popupRelated || [];
      const popupContent = document.getElementById('popupContent');

      popupContent.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
          <h3 style="text-transform:uppercase;">${value || ''}</h3>
          <div style="display:flex;gap:.35rem;">
            <button class="bm-btn" onclick="copyAllInPopup(this)" title="Copy all">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                   fill="none" stroke="currentColor" stroke-width="2"
                   stroke-linecap="round" stroke-linejoin="round">
                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="popup-list" style="max-height:420px;overflow-y:auto;margin-top:.5rem;">
          ${
            relatedData.map((item, idx)=>{
              const id = getItemId(item);
              const isBookmarked = bookmarks.has(id);
              return `
              <div class="popup-item ${isBookmarked?'open':''}">
                <div style="display:flex;align-items:center;justify-content:space-between;gap:.5rem;">
                  <div style="cursor:pointer;flex:1" onclick="togglePopupDetail(this)">
                    <strong>${formatPopupSectionDisplay(item.chapter,item.section,item.subsection)}</strong> : ${toUpperDisplay(item.titleEn || '')}
                  </div>
                  <div style="display:flex;gap:.3rem;">
                    <button class="bm-btn" title="Copy" onclick="popupCopy(${idx}, this);event.stopPropagation();">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                           fill="none" stroke="currentColor" stroke-width="2"
                           stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px">
                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                      </svg>
                    </button>
                    <button class="bm-btn ${isBookmarked?'active':''}" title="Bookmark"
                            onclick="popupBookmark('${id}', ${idx}, this);event.stopPropagation();">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                           fill="none" stroke="currentColor" stroke-width="2"
                           stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px">
                        <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="popup-detail" style="display:${isBookmarked?'block':'none'};margin-top:.6rem;">
                  ${item.titleKo ? `<div style="margin:.25rem 0;color:#666;"><em>${item.titleKo}</em></div>`:''}
                  ${item.provisionEn ? `<div style="margin:.4rem 0;line-height:1.7">${item.provisionEn}</div>`:''}
                  ${item.provisionKo ? `<div style="margin:.25rem 0;color:#555;line-height:1.6">${item.provisionKo}</div>`:''}
                  <!-- Notes는 팝업에 표시하지 않음 -->
                </div>
              </div>`;
            }).join('')
          }
        </div>
      `;
    }

    function togglePopupDetail(el){
      const item = el.closest('.popup-item');
      const detail = item.querySelector('.popup-detail');
      const show = (detail.style.display==='none'||!detail.style.display)?'block':'none';
      detail.style.display = show;
      item.classList.toggle('open', show==='block');
    }
    function popupCopy(idx, btn){
      const item = (window.__popupRelated || [])[idx];
      if (!item) return;
      const text = buildCopyText(item); // Notes 제외
      navigator.clipboard?.writeText(text).then(()=>showMiniToast(btn));
    }
    function popupBookmark(id, idx, btn){
      if (bookmarks.has(id)) bookmarks.delete(id);
      else bookmarks.add(id);
      openBookmarkPanel(true);
      renderPopupList();
    }
    function copyAllInPopup(btn){
      const items = window.__popupRelated || [];
      if (!items.length) return;
      const text = items.map(buildCopyText).join('\n\n——————\n\n'); // Notes 제외
      navigator.clipboard?.writeText(text).then(()=>showMiniToast(btn));
    }
    function closePopup(){ document.getElementById('popup').style.display='none'; }

    /* =========================
       SEARCH / FILTER / EVENTS
       ========================= */
    function setupEventListeners(){
      const searchInput = document.getElementById('searchInput');
      const clearBtn = document.getElementById('clearSearch');

      function livePreview(){
        // 실시간 미리보기 — 확정 검색은 Enter에서 수행
        lastSearchTerm = searchInput.value.trim();
        clearBtn.style.display = lastSearchTerm.length ? 'inline-flex' : 'none';

        if (!lastSearchTerm){
          filteredData = allData;
          currentSearchResults = [];
          currentPage = 1;
          displayResults(filteredData);
          updateContentHeader('Welcome to US Code Navigator','Search and explore IBC 2024 provisions');
          return;
        }

        // 스코어 검색 미리보기
        const res = allData.map(item => ({ item, ...scoreItem(item, lastSearchTerm) }))
                           .filter(x => x.matched)
                           .sort((a,b)=> b.score - a.score)
                           .map(x => x.item);
        currentSearchResults = res.slice();
        filteredData = res;
        currentPage = 1;
        displayResults(filteredData);
        updateContentHeader('Search Results (preview)', `${filteredData.length} provisions found`);
      }

      // 최근 검색 저장소
      loadRecentSearches();
      renderRecentSuggest();

      searchInput.addEventListener('focus', ()=>{
        renderRecentSuggest(searchInput.value);
        showRecentSuggest();
      });
      searchInput.addEventListener('input', ()=>{
        livePreview();
        renderRecentSuggest(searchInput.value);
        if (searchInput.value) showRecentSuggest();
      });
      searchInput.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter'){
          e.preventDefault();
          performCommittedSearch(searchInput.value.trim());
        }
      });

      clearBtn.addEventListener('click', ()=>{
        searchInput.value = '';
        lastSearchTerm = '';
        currentSearchResults = [];
        filteredData = allData;
        currentPage = 1;
        displayResults(filteredData);
        updateContentHeader('Welcome to US Code Navigator','Search and explore IBC 2024 provisions');
        hideRecentSuggest();
        searchInput.focus();
        clearBtn.style.display = 'none';
      });

      // View toggle
      document.getElementById('viewToggle').addEventListener('click', toggleViewMode);

      // scroll-top (컨테이너 기준) — bindScrollBtn에서 1회 바인딩
      bindScrollBtn();

      // filter panel toggle
      document.getElementById('filterBtn').addEventListener('click', function(){
        const panel = document.getElementById('filterPanel');
        const btn = this;
        if (panel.style.display==='none' || panel.style.display===''){
          panel.style.display='block'; btn.classList.add('active');
        } else {
          panel.style.display='none'; btn.classList.remove('active');
        }
      });

      // reset filters (Refresh)
      document.getElementById('resetBtn').addEventListener('click', resetAllFilters);

      // inside panel
      document.getElementById('filterPanel').addEventListener('change', function(e){
        if (e.target.matches('input[type="checkbox"], input[type="number"]')){
          updateFilters(); updateActiveFiltersDisplay(); applyFilters();
        }
      });

      // master checks
      document.getElementById('codeAllCheck').addEventListener('change', function(){
        const checked = this.checked;
        document.querySelectorAll('#codeOptions input[type="checkbox"]').forEach(cb=> cb.checked = checked);
        updateFilters(); updateActiveFiltersDisplay(); applyFilters();
      });
      document.getElementById('stageAllCheck').addEventListener('change', function(){
        const checked = this.checked;
        document.querySelectorAll('#stagesOptions input[type="checkbox"]').forEach(cb=> cb.checked = checked);
        updateFilters(); updateActiveFiltersDisplay(); applyFilters();
      });
      document.getElementById('categoryAllCheck').addEventListener('change', function(){
        const checked = this.checked;
        document.querySelectorAll('#categoriesOptions input[type="checkbox"]').forEach(cb=> cb.checked = checked);
        updateFilters(); updateActiveFiltersDisplay(); applyFilters();
      });
      document.getElementById('projectAllCheck').addEventListener('change', function(){
        const checked = this.checked;
        document.querySelectorAll('#projectsOptions input[type="checkbox"]').forEach(cb=> cb.checked = checked);
        updateFilters(); updateActiveFiltersDisplay(); applyFilters();
      });

      // click outside filter panel to close
      document.addEventListener('click', function(e){
        const panel = document.getElementById('filterPanel');
        const btn = document.getElementById('filterBtn');
        if (!panel.contains(e.target) && !btn.contains(e.target)){
          panel.style.display='none';
          btn.classList.remove('active');
        }
      });

      // Bookmark panel handle + copy/print
      document.getElementById('bookmarkPrintBtn').addEventListener('click', printSelectedBookmarks);
      document.getElementById('bookmarkCopyBtn').addEventListener('click', async ()=>{ await copySelectedBookmarks(); });

      // 초기 스크롤 버튼 상태
      document.getElementById('scrollTop').style.display = 'none';
    }

    // 확정 검색(Enter) — Enter 아이콘 없이 기능만 유지
    function performCommittedSearch(q){
      if (!q) return;
      lastSearchTerm = q;

      const res = allData.map(item => ({ item, ...scoreItem(item, q) }))
                         .filter(x => x.matched)
                         .sort((a,b)=> b.score - a.score)
                         .map(x => x.item);

      currentSearchResults = res.slice();
      filteredData = res;
      currentPage = 1;
      displayResults(filteredData);
      updateContentHeader('Search Results', `${filteredData.length} provisions found`);

      // 최근 검색 업데이트 & 저장
      addRecentSearch(q);

      // 입력값 비우고 제안 닫기
      const searchInput = document.getElementById('searchInput');
      searchInput.value = '';
      hideRecentSuggest();
      document.getElementById('clearSearch').style.display = 'none';
    }

    /* 최근 검색어 제안 */
    function loadRecentSearches(){
      try{
        const raw = localStorage.getItem('ucn_recent_searches');
        recentSearches = raw ? JSON.parse(raw) : [];
      }catch{ recentSearches = []; }
    }
    function saveRecentSearches(){
      localStorage.setItem('ucn_recent_searches', JSON.stringify(recentSearches));
    }
    function addRecentSearch(term){
      term = term.trim();
      if (!term) return;
      recentSearches = [term, ...recentSearches.filter(t => t !== term)].slice(0,10);
      saveRecentSearches();
    }
    function renderRecentSuggest(filter=''){
      const box = document.getElementById('recentSuggest');
      const list = (!filter ? recentSearches : recentSearches.filter(t=>t.toLowerCase().includes(filter.toLowerCase())));
      if (!list.length){
        box.innerHTML = `<h6>Recent searches</h6><div class="empty">No recent terms</div>`;
        return;
      }
      box.innerHTML = `<h6>Recent searches</h6>` + list.map(t=>`
        <div class="recent-item" data-term="${t}">
          <div class="recent-term">${t}</div>
          <button class="recent-remove" title="Remove" data-remove="${t}">×</button>
        </div>
      `).join('');

      // 클릭: 입력창에 넣고 미리보기 갱신
      box.querySelectorAll('.recent-item').forEach(row=>{
        row.addEventListener('click', (e)=>{
          if (e.target && e.target.matches('.recent-remove')) return; // X 클릭은 삭제로 넘김
          const term = row.getAttribute('data-term');
          const input = document.getElementById('searchInput');
          input.value = term;
          input.focus();
          // 즉시 확정 검색으로 연결하려면 아래 한 줄 사용:
          performCommittedSearch(term);
        });
      });
      // X 버튼 삭제
      box.querySelectorAll('.recent-remove').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          e.stopPropagation();
          const term = btn.getAttribute('data-remove');
          recentSearches = recentSearches.filter(t => t !== term);
          saveRecentSearches();
          renderRecentSuggest(document.getElementById('searchInput').value);
        });
      });
    }
    function showRecentSuggest(){ document.getElementById('recentSuggest').style.display = 'block'; }
    function hideRecentSuggest(){ document.getElementById('recentSuggest').style.display = 'none'; }

    // Active filters state
    let activeFilters = { codes:[], stages:[], categories:[], projects:[], chapter:null, section:null };

    function resetAllFilters(){
      activeFilters = { codes:[], stages:[], categories:[], projects:[], chapter:null, section:null };
      document.querySelectorAll('#filterPanel input[type="checkbox"]').forEach(cb=> cb.checked=false);
      document.querySelectorAll('#filterPanel input[type="number"]').forEach(i=> i.value='');
      lastSearchTerm = '';
      document.getElementById('searchInput').value='';
      updateActiveFiltersDisplay(); applyFilters();
      updateContentHeader('Welcome to US Code Navigator','Search and explore IBC 2024 provisions');
    }

    function updateFilters(){
      activeFilters.codes = [];
      activeFilters.stages = [];
      activeFilters.categories = [];
      activeFilters.projects = [];

      document.querySelectorAll('#filterPanel input[type="checkbox"]:checked').forEach(cb=>{
        const val = cb.value;
        if (cb.closest('#codeOptions')) activeFilters.codes.push(val);
        else if (cb.closest('#stagesOptions')) activeFilters.stages.push(val);
        else if (cb.closest('#categoriesOptions')) activeFilters.categories.push(val);
        else if (cb.closest('#projectsOptions')) activeFilters.projects.push(val);
      });

      activeFilters.chapter = document.getElementById('ibcChapter').value || null;
      activeFilters.section = document.getElementById('ibcSection').value || null;
    }

    function updateActiveFiltersDisplay(){
      const container = document.getElementById('activeFilters');
      container.innerHTML = '';
      const tags = [
        ...activeFilters.codes,
        ...activeFilters.stages,
        ...activeFilters.categories,
        ...activeFilters.projects
      ];
      if (activeFilters.chapter) tags.push(`Ch.${activeFilters.chapter}`);
      if (activeFilters.section) tags.push(`Sec.${activeFilters.section}`);

      tags.forEach(val=>{
        const tag = document.createElement('div');
        tag.className='active-filter';
        tag.innerHTML = `${val} <span class="filter-remove">×</span>`;
        tag.querySelector('.filter-remove').addEventListener('click', ()=> removeFilter(val));
        container.appendChild(tag);
      });
    }

    function removeFilter(value){
      if (value.startsWith('Ch.')){
        document.getElementById('ibcChapter').value='';
        activeFilters.chapter=null;
      } else if (value.startsWith('Sec.')){
        document.getElementById('ibcSection').value='';
        activeFilters.section=null;
      } else {
        document.querySelectorAll(`#filterPanel input[type="checkbox"][value="${CSS.escape(value)}"]`).forEach(cb=> cb.checked=false);
        activeFilters.codes = activeFilters.codes.filter(v=>v!==value);
        activeFilters.stages = activeFilters.stages.filter(v=>v!==value);
        activeFilters.categories = activeFilters.categories.filter(v=>v!==value);
        activeFilters.projects = activeFilters.projects.filter(v=>v!==value);
      }
      updateActiveFiltersDisplay(); applyFilters();
    }

    function applyFilters(){
      let base = currentSearchResults.length ? currentSearchResults : allData;

      if (activeFilters.chapter){ base = base.filter(item => (item.chapter||'').includes(activeFilters.chapter)); }
      if (activeFilters.section){ base = base.filter(item => (item.section||'').includes(activeFilters.section)); }
      if (activeFilters.stages.length){
        base = base.filter(item => activeFilters.stages.includes(item.designStage));
      }
      if (activeFilters.categories.length){
        base = base.filter(item=>{
          const cats = splitMultiline(item.designCategory);
          return cats.some(c=> activeFilters.categories.includes(c));
        });
      }
      if (activeFilters.projects.length){
        base = base.filter(item=>{
          const ps = splitMultiline(item.projectApplication);
          return ps.some(p=> activeFilters.projects.includes(p));
        });
      }

      filteredData = base;
      currentPage = 1;
      displayResults(filteredData);
      updateContentHeader('Filtered Results', `${filteredData.length} provisions found`);
    }

    function updateContentHeader(title, subtitle){
      document.getElementById('contentTitle').textContent = title;
      document.getElementById('contentSubtitle').textContent = subtitle;
    }

    /* =========================
       SIDEBAR FILTER ACTIONS
       ========================= */
    function filterOverview(el){
      // Overview 데이터: chapter가 'IBC 2024'이거나 섹션/제목에 overview가 포함된 항목
      filteredData = allData.filter(i =>
        String(i.chapter||'').trim().toUpperCase() === 'IBC 2024'
        || /overview/i.test(String(i.section||''))
        || /overview/i.test(String(i.titleEn||''))
      );
      currentSearchResults = [];
      lastSearchTerm = '';
      currentPage = 1;
      displayResults(filteredData);
      updateContentHeader(`Overview`, `${filteredData.length} provisions found`);
      setActive(el.closest('.menu-item'));
    }

    function filterByChapter(chapter, el){
      filteredData = allData.filter(i=> String(i.chapter||'').trim() === chapter);
      currentSearchResults = [];
      lastSearchTerm = '';
      currentPage = 1;
      displayResults(filteredData);
      updateContentHeader(`Chapter: ${chapter}`, `${filteredData.length} provisions found`);
      setActive(el.closest('.menu-item'));
    }
    function filterBySection(section, el){
      filteredData = allData.filter(i=> String(i.section||'').trim() === section);
      currentSearchResults = [];
      lastSearchTerm = '';
      currentPage = 1;
      displayResults(filteredData);
      updateContentHeader(`Section: ${section}`, `${filteredData.length} provisions found`);
      setActive(el);
    }
    function filterByDesignStage(stage, el){
      filteredData = allData.filter(i=> String(i.designStage||'').trim() === stage);
      currentSearchResults = [];
      lastSearchTerm = '';
      currentPage = 1;
      displayResults(filteredData);
      updateContentHeader(`Design Stage: ${stage}`, `${filteredData.length} provisions found`);
      setActive(el);
    }
    function filterByDesignCategory(category, el){
      filteredData = allData.filter(i=> splitMultiline(i.designCategory).includes(category));
      currentSearchResults = [];
      lastSearchTerm = '';
      currentPage = 1;
      displayResults(filteredData);
      updateContentHeader(`Design Category: ${category}`, `${filteredData.length} provisions found`);
      setActive(el);
    }
    function filterByProjectApplication(project, el){
      filteredData = allData.filter(i=> splitMultiline(i.projectApplication).includes(project));
      currentSearchResults = [];
      lastSearchTerm = '';
      currentPage = 1;
      displayResults(filteredData);
      updateContentHeader(`Project Application: ${project}`, `${filteredData.length} provisions found`);
      setActive(el);
    }

    // 전역 노출
    window.filterByChapter = filterByChapter;
    window.filterBySection = filterBySection;
    window.filterByDesignStage = filterByDesignStage;
    window.filterByDesignCategory = filterByDesignCategory;
    window.filterByProjectApplication = filterByProjectApplication;
    window.copyProvision = copyProvision;
    window.showKeywordPopup = showKeywordPopup;
    window.closePopup = closePopup;
    window.toggleChapterAndFilter = toggleChapterAndFilter;
    window.toggleListItem = toggleListItem;
    window.toggleBookmark = toggleBookmark;
    window.filterOverview = filterOverview;
  </script>
</body>
</html>

