<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Comparison - US Code Navigator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background-color: #F8F9FA;
            color: #2C3E50;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background-color: #FFFFFF;
            border-bottom: 1px solid #DEE2E6;
            padding: 16px 32px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }

        .logo {
            font-size: 20px;
            font-weight: 600;
            color: #2C3E50;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            margin: 0 32px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 10px 16px 10px 40px;
            border: 1px solid #DEE2E6;
            border-radius: 4px;
            font-size: 14px;
            background-color: #F8F9FA;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6C757D;
        }

        .header-actions {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .header-btn {
            padding: 8px 16px;
            background-color: transparent;
            border: 1px solid #DEE2E6;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #2C3E50;
            text-decoration: none;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 72px;
            width: 240px;
            height: calc(100vh - 72px);
            background-color: #FFFFFF;
            border-right: 1px solid #DEE2E6;
            padding: 24px 16px;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-section h3 {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: #6C757D;
            margin-bottom: 12px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 4px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            color: #2C3E50;
            text-decoration: none;
            font-size: 14px;
            border-radius: 4px;
        }

        .sidebar-menu a:hover {
            background-color: #F8F9FA;
        }

        .sidebar-menu a.active {
            background-color: #3498DB;
            color: #FFFFFF;
        }

        /* Main Content */
        .main-with-sidebar {
            margin-left: 240px;
        }

        .page-header {
            background-color: #FFFFFF;
            border-bottom: 1px solid #DEE2E6;
            padding: 32px;
        }

        .page-header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2C3E50;
        }

        .page-header p {
            color: #6C757D;
            font-size: 14px;
        }

        .toolbar {
            background-color: #FFFFFF;
            border-bottom: 1px solid #DEE2E6;
            padding: 16px 32px;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toolbar-label {
            font-size: 13px;
            font-weight: 500;
            color: #6C757D;
        }

        .toolbar-btn {
            padding: 6px 12px;
            background-color: #F8F9FA;
            border: 1px solid #DEE2E6;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            color: #2C3E50;
        }

        .toolbar-btn.active {
            background-color: #2C3E50;
            color: #FFFFFF;
            border-color: #2C3E50;
        }

        .btn-primary {
            background-color: #3498DB;
            color: #FFFFFF;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .btn-primary:hover {
            background-color: #2980B9;
        }

        /* Comparison Form */
        .comparison-form {
            padding: 32px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .document-selector {
            background-color: #FFFFFF;
            border: 1px solid #DEE2E6;
            border-radius: 8px;
            padding: 24px;
        }

        .document-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #2C3E50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #2C3E50;
            margin-bottom: 6px;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #DEE2E6;
            border-radius: 4px;
            font-size: 14px;
            background-color: #FFFFFF;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #3498DB;
        }

        .vs-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: #6C757D;
            padding-top: 24px;
        }

        .compare-btn-container {
            text-align: center;
        }

        /* Comparison Results */
        .comparison-results {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px;
        }

        .results-summary {
            background-color: #FFFFFF;
            border: 1px solid #DEE2E6;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #2C3E50;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .stat-card {
            background-color: #F8F9FA;
            padding: 16px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #6C757D;
        }

        /* Side by Side View */
        .side-by-side {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .code-panel {
            background-color: #FFFFFF;
            border: 1px solid #DEE2E6;
            border-radius: 8px;
            overflow: hidden;
        }

        .panel-header {
            background-color: #F8F9FA;
            padding: 16px 20px;
            border-bottom: 1px solid #DEE2E6;
        }

        .panel-title {
            font-size: 14px;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 4px;
        }

        .panel-subtitle {
            font-size: 12px;
            color: #6C757D;
        }

        .panel-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .code-section {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #F0F0F0;
        }

        .code-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 8px;
        }

        .section-subtitle {
            font-size: 14px;
            color: #6C757D;
            margin-bottom: 12px;
        }

        .section-text {
            font-size: 14px;
            line-height: 1.7;
            color: #2C3E50;
        }

        .highlight {
            background-color: #FFF3CD;
            padding: 2px 4px;
        }

        .highlight-add {
            background-color: #D4EDDA;
            padding: 2px 4px;
        }

        .highlight-remove {
            background-color: #F8D7DA;
            padding: 2px 4px;
            text-decoration: line-through;
        }

        /* Difference Summary */
        .difference-summary {
            background-color: #FFFFFF;
            border: 1px solid #DEE2E6;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .diff-item {
            padding: 16px;
            border-left: 4px solid #3498DB;
            background-color: #F8F9FA;
            margin-bottom: 12px;
            border-radius: 4px;
        }

        .diff-item.added {
            border-left-color: #27AE60;
        }

        .diff-item.removed {
            border-left-color: #E74C3C;
        }

        .diff-item.modified {
            border-left-color: #F39C12;
        }

        .diff-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .diff-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 4px 8px;
            border-radius: 4px;
            background-color: #FFFFFF;
        }

        .diff-label.added {
            color: #27AE60;
        }

        .diff-label.removed {
            color: #E74C3C;
        }

        .diff-label.modified {
            color: #F39C12;
        }

        .diff-title {
            font-size: 14px;
            font-weight: 600;
            color: #2C3E50;
            margin-bottom: 4px;
        }

        .diff-content {
            font-size: 13px;
            color: #6C757D;
            line-height: 1.6;
        }

        .no-results {
            text-align: center;
            padding: 64px 32px;
            color: #6C757D;
        }

        .no-results-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-section">
            <h3>Browse Libraries</h3>
            <ul class="sidebar-menu">
                <li><a href="index.html">📋 Codes</a></li>
                <li><a href="image-library.html">🖼️ Images</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <h3>Comparison Tools</h3>
            <ul class="sidebar-menu">
                <li><a href="code-comparison.html" class="active">⚖️ Side by Side</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <h3>Code Types</h3>
            <ul class="sidebar-menu">
                <li><a href="#">📋 IBC</a></li>
                <li><a href="#">🔥 NFPA</a></li>
                <li><a href="#">⚡ NEC</a></li>
                <li><a href="#">🔧 IMC</a></li>
                <li><a href="#">🚰 IPC</a></li>
            </ul>
        </div>

        <div class="sidebar-section">
            <h3>Quick Access</h3>
            <ul class="sidebar-menu">
                <li><a href="#">⭐ Favorites</a></li>
                <li><a href="#">🕒 Recent</a></li>
                <li><a href="#">💾 Saved Comparisons</a></li>
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-with-sidebar">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo">US Code Navigator</div>
                <div class="search-bar">
                    <span class="search-icon">🔍</span>
                    <input type="text" placeholder="Search codes for comparison...">
                </div>
                <div class="header-actions">
                    <a href="#" class="header-btn">Bookmarks</a>
                    <a href="index.html" class="header-btn">Back to Home</a>
                </div>
            </div>
        </div>

        <!-- Page Header -->
        <div class="page-header">
            <h1>Code Comparison Tool</h1>
            <p>Compare different code versions, sections, and jurisdictions side by side</p>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <span class="toolbar-label">View Mode:</span>
            <button class="toolbar-btn active" onclick="setViewMode('side-by-side')">◫ Side by Side</button>
            <button class="toolbar-btn" onclick="setViewMode('unified')">☰ Unified</button>

            <span class="toolbar-label" style="margin-left: 16px;">Highlight:</span>
            <button class="toolbar-btn" onclick="toggleHighlight('differences')">🔍 Differences</button>
            <button class="toolbar-btn" onclick="toggleHighlight('additions')">➕ Additions</button>
            <button class="toolbar-btn" onclick="toggleHighlight('deletions')">➖ Deletions</button>
        </div>

        <!-- Comparison Form -->
        <div class="comparison-form">
            <div class="comparison-grid">
                <!-- Document A -->
                <div class="document-selector">
                    <div class="document-title">
                        Document A
                        <button onclick="clearDocument('A')" style="background:none;border:none;cursor:pointer;color:#6C757D;">✕</button>
                    </div>

                    <div class="form-group">
                        <label>Code Type</label>
                        <select id="codeTypeA" onchange="updateVersionsA()">
                            <option value="">Select Code Type</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Version / Year</label>
                        <select id="versionA" onchange="updateChaptersA()">
                            <option value="">Select Version</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Jurisdiction (Optional)</label>
                        <select id="jurisdictionA">
                            <option value="">All Jurisdictions</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Chapter</label>
                        <select id="chapterA" onchange="updateSectionsA()">
                            <option value="">Select Chapter</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Section (Optional)</label>
                        <input type="text" id="sectionA" placeholder="e.g., 301.1">
                    </div>

                    <div class="form-group">
                        <label>Discipline</label>
                        <select id="disciplineA">
                            <option value="">All Disciplines</option>
                        </select>
                    </div>
                </div>

                <!-- VS Divider -->
                <div class="vs-divider">
                    <div style="width:60px;height:60px;background:#F8F9FA;border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid #DEE2E6;">
                        VS
                    </div>
                </div>

                <!-- Document B -->
                <div class="document-selector">
                    <div class="document-title">
                        Document B
                        <button onclick="clearDocument('B')" style="background:none;border:none;cursor:pointer;color:#6C757D;">✕</button>
                    </div>

                    <div class="form-group">
                        <label>Code Type</label>
                        <select id="codeTypeB" onchange="updateVersionsB()">
                            <option value="">Select Code Type</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Version / Year</label>
                        <select id="versionB" onchange="updateChaptersB()">
                            <option value="">Select Version</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Jurisdiction (Optional)</label>
                        <select id="jurisdictionB">
                            <option value="">All Jurisdictions</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Chapter</label>
                        <select id="chapterB" onchange="updateSectionsB()">
                            <option value="">Select Chapter</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Section (Optional)</label>
                        <input type="text" id="sectionB" placeholder="e.g., 301.1">
                    </div>

                    <div class="form-group">
                        <label>Discipline</label>
                        <select id="disciplineB">
                            <option value="">All Disciplines</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="compare-btn-container">
                <button class="btn-primary" onclick="performComparison()" style="padding:12px 48px;font-size:16px;">
                    🔍 Start Comparison
                </button>
            </div>
        </div>

        <!-- Comparison Results -->
        <div id="comparisonResults" style="display:none;">
            <!-- Results will be populated here -->
        </div>
    </div>

    <script>
        // Load JSON data
        let modelCodes = [];
        let modelCodeVersions = [];
        let codeContent = [];
        let codeChapters = [];
        let disciplines = [];
        let jurisdictions = [];
        let modelCodeDiscipline = [];

        // Load data
        async function loadData() {
            try {
                const [mc, mcv, cc, ch, d, j, mcd] = await Promise.all([
                    fetch('ModelCode.json').then(r => r.json()),
                    fetch('ModelCodeVersion.json').then(r => r.json()),
                    fetch('CodeContent.json').then(r => r.json()),
                    fetch('CodeChapter.json').then(r => r.json()),
                    fetch('Discipline.json').then(r => r.json()),
                    fetch('Jurisdiction.json').then(r => r.json()),
                    fetch('ModelCodeDiscipline.json').then(r => r.json())
                ]);

                modelCodes = mc;
                modelCodeVersions = mcv;
                codeContent = cc;
                codeChapters = ch;
                disciplines = d;
                jurisdictions = j;
                modelCodeDiscipline = mcd;

                populateSelectors();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function populateSelectors() {
            // Populate Code Types
            const codeTypeA = document.getElementById('codeTypeA');
            const codeTypeB = document.getElementById('codeTypeB');

            modelCodes.forEach(code => {
                const optionA = new Option(code.Description || code.ModelCodeName, code.ModelCodeID);
                const optionB = new Option(code.Description || code.ModelCodeName, code.ModelCodeID);
                codeTypeA.add(optionA);
                codeTypeB.add(optionB);
            });

            // Populate Jurisdictions
            const jurisdictionA = document.getElementById('jurisdictionA');
            const jurisdictionB = document.getElementById('jurisdictionB');

            jurisdictions.forEach(j => {
                const optionA = new Option(`${j.StateName} (${j.StateCode})`, j.JurisdictionID);
                const optionB = new Option(`${j.StateName} (${j.StateCode})`, j.JurisdictionID);
                jurisdictionA.add(optionA);
                jurisdictionB.add(optionB);
            });

            // Populate Disciplines
            const disciplineA = document.getElementById('disciplineA');
            const disciplineB = document.getElementById('disciplineB');

            disciplines.forEach(d => {
                const optionA = new Option(`${d.DisciplineNameEN} (${d.DisciplineNameKR})`, d.DisciplineID);
                const optionB = new Option(`${d.DisciplineNameEN} (${d.DisciplineNameKR})`, d.DisciplineID);
                disciplineA.add(optionA);
                disciplineB.add(optionB);
            });
        }

        function updateVersionsA() {
            const codeTypeId = document.getElementById('codeTypeA').value;
            const versionSelect = document.getElementById('versionA');
            versionSelect.innerHTML = '<option value="">Select Version</option>';

            const versions = modelCodeVersions.filter(v => v.ModelCodeID === codeTypeId);
            versions.forEach(v => {
                const option = new Option(
                    v.Year ? `${v.Year} Edition` : v.Description,
                    v.ModelCodeVersionID
                );
                versionSelect.add(option);
            });
        }

        function updateVersionsB() {
            const codeTypeId = document.getElementById('codeTypeB').value;
            const versionSelect = document.getElementById('versionB');
            versionSelect.innerHTML = '<option value="">Select Version</option>';

            const versions = modelCodeVersions.filter(v => v.ModelCodeID === codeTypeId);
            versions.forEach(v => {
                const option = new Option(
                    v.Year ? `${v.Year} Edition` : v.Description,
                    v.ModelCodeVersionID
                );
                versionSelect.add(option);
            });
        }

        function updateChaptersA() {
            const versionId = document.getElementById('versionA').value;
            const chapterSelect = document.getElementById('chapterA');
            chapterSelect.innerHTML = '<option value="">Select Chapter</option>';

            const chapters = codeChapters.filter(ch => ch.ModelCodeVersionID === versionId);
            chapters.forEach(ch => {
                const option = new Option(
                    `Chapter ${ch.Chapter}: ${ch.TitleEN}`,
                    ch.Chapter
                );
                chapterSelect.add(option);
            });
        }

        function updateChaptersB() {
            const versionId = document.getElementById('versionB').value;
            const chapterSelect = document.getElementById('chapterB');
            chapterSelect.innerHTML = '<option value="">Select Chapter</option>';

            const chapters = codeChapters.filter(ch => ch.ModelCodeVersionID === versionId);
            chapters.forEach(ch => {
                const option = new Option(
                    `Chapter ${ch.Chapter}: ${ch.TitleEN}`,
                    ch.Chapter
                );
                chapterSelect.add(option);
            });
        }

        function updateSectionsA() {
            // Optional: Could populate section suggestions
        }

        function updateSectionsB() {
            // Optional: Could populate section suggestions
        }

        function clearDocument(doc) {
            if (doc === 'A') {
                document.getElementById('codeTypeA').value = '';
                document.getElementById('versionA').innerHTML = '<option value="">Select Version</option>';
                document.getElementById('jurisdictionA').value = '';
                document.getElementById('chapterA').innerHTML = '<option value="">Select Chapter</option>';
                document.getElementById('sectionA').value = '';
                document.getElementById('disciplineA').value = '';
            } else {
                document.getElementById('codeTypeB').value = '';
                document.getElementById('versionB').innerHTML = '<option value="">Select Version</option>';
                document.getElementById('jurisdictionB').value = '';
                document.getElementById('chapterB').innerHTML = '<option value="">Select Chapter</option>';
                document.getElementById('sectionB').value = '';
                document.getElementById('disciplineB').value = '';
            }
        }

        function performComparison() {
            const versionA = document.getElementById('versionA').value;
            const versionB = document.getElementById('versionB').value;
            const chapterA = document.getElementById('chapterA').value;
            const chapterB = document.getElementById('chapterB').value;
            const sectionA = document.getElementById('sectionA').value;
            const sectionB = document.getElementById('sectionB').value;

            if (!versionA || !versionB || !chapterA || !chapterB) {
                alert('Please select code type, version, and chapter for both documents');
                return;
            }

            // Get content for both documents
            let contentsA = codeContent.filter(c =>
                c.ModelCodeVersionID === versionA &&
                c.Chapter.toString() === chapterA
            );

            let contentsB = codeContent.filter(c =>
                c.ModelCodeVersionID === versionB &&
                c.Chapter.toString() === chapterB
            );

            // Filter by section if specified
            if (sectionA) {
                contentsA = contentsA.filter(c =>
                    c.Section && c.Section.toString().includes(sectionA)
                );
            }

            if (sectionB) {
                contentsB = contentsB.filter(c =>
                    c.Section && c.Section.toString().includes(sectionB)
                );
            }

            displayComparison(contentsA, contentsB, versionA, versionB, chapterA, chapterB);
        }

        function displayComparison(contentsA, contentsB, versionA, versionB, chapterA, chapterB) {
            const resultsDiv = document.getElementById('comparisonResults');
            const codeA = modelCodes.find(m => {
                const version = modelCodeVersions.find(v => v.ModelCodeVersionID === versionA);
                return version && version.ModelCodeID === m.ModelCodeID;
            });
            const codeB = modelCodes.find(m => {
                const version = modelCodeVersions.find(v => v.ModelCodeVersionID === versionB);
                return version && version.ModelCodeID === m.ModelCodeID;
            });

            const versionInfoA = modelCodeVersions.find(v => v.ModelCodeVersionID === versionA);
            const versionInfoB = modelCodeVersions.find(v => v.ModelCodeVersionID === versionB);

            const chapterInfoA = codeChapters.find(ch => ch.ModelCodeVersionID === versionA && ch.Chapter.toString() === chapterA);
            const chapterInfoB = codeChapters.find(ch => ch.ModelCodeVersionID === versionB && ch.Chapter.toString() === chapterB);

            const matches = contentsA.filter(a =>
                contentsB.some(b =>
                    a.TitleEN === b.TitleEN ||
                    a.Section === b.Section
                )
            ).length;

            const differences = Math.max(contentsA.length, contentsB.length) - matches;

            resultsDiv.innerHTML = `
                <div class="comparison-results">
                    <div class="results-summary">
                        <h2 class="summary-title">Comparison Summary</h2>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">✓</div>
                                <div class="stat-value">${matches}</div>
                                <div class="stat-label">Matches</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">△</div>
                                <div class="stat-value">${differences}</div>
                                <div class="stat-label">Differences</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">Σ</div>
                                <div class="stat-value">${contentsA.length + contentsB.length}</div>
                                <div class="stat-label">Total Sections</div>
                            </div>
                        </div>
                    </div>

                    <div class="side-by-side">
                        <div class="code-panel">
                            <div class="panel-header">
                                <div class="panel-title">${codeA ? codeA.ModelCodeName : 'Document A'} - ${versionInfoA ? versionInfoA.Year : ''}</div>
                                <div class="panel-subtitle">Chapter ${chapterA}: ${chapterInfoA ? chapterInfoA.TitleEN : ''}</div>
                            </div>
                            <div class="panel-content">
                                ${contentsA.map(content => `
                                    <div class="code-section">
                                        <div class="section-title">${content.TitleEN || 'Untitled'}</div>
                                        ${content.TitleKR ? `<div class="section-subtitle">${content.TitleKR}</div>` : ''}
                                        <div class="section-text">${content.ContentEN || ''}</div>
                                        ${content.ContentKR ? `<div class="section-text" style="margin-top:12px;color:#6C757D;">${content.ContentKR}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div class="code-panel">
                            <div class="panel-header">
                                <div class="panel-title">${codeB ? codeB.ModelCodeName : 'Document B'} - ${versionInfoB ? versionInfoB.Year : ''}</div>
                                <div class="panel-subtitle">Chapter ${chapterB}: ${chapterInfoB ? chapterInfoB.TitleEN : ''}</div>
                            </div>
                            <div class="panel-content">
                                ${contentsB.map(content => `
                                    <div class="code-section">
                                        <div class="section-title">${content.TitleEN || 'Untitled'}</div>
                                        ${content.TitleKR ? `<div class="section-subtitle">${content.TitleKR}</div>` : ''}
                                        <div class="section-text">${content.ContentEN || ''}</div>
                                        ${content.ContentKR ? `<div class="section-text" style="margin-top:12px;color:#6C757D;">${content.ContentKR}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <div class="difference-summary">
                        <h2 class="summary-title">Detailed Differences</h2>
                        ${generateDifferences(contentsA, contentsB)}
                    </div>
                </div>
            `;

            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function generateDifferences(contentsA, contentsB) {
            const diffs = [];

            // Find items only in A
            contentsA.forEach(a => {
                const matchB = contentsB.find(b => b.TitleEN === a.TitleEN || b.Section === a.Section);
                if (!matchB) {
                    diffs.push({
                        type: 'removed',
                        title: a.TitleEN,
                        content: a.ContentEN ? a.ContentEN.substring(0, 150) + '...' : ''
                    });
                } else if (a.ContentEN !== matchB.ContentEN) {
                    diffs.push({
                        type: 'modified',
                        title: a.TitleEN,
                        content: 'Content has been modified between versions'
                    });
                }
            });

            // Find items only in B
            contentsB.forEach(b => {
                const matchA = contentsA.find(a => a.TitleEN === b.TitleEN || a.Section === b.Section);
                if (!matchA) {
                    diffs.push({
                        type: 'added',
                        title: b.TitleEN,
                        content: b.ContentEN ? b.ContentEN.substring(0, 150) + '...' : ''
                    });
                }
            });

            if (diffs.length === 0) {
                return '<p style="text-align:center;color:#6C757D;padding:32px;">No significant differences found</p>';
            }

            return diffs.map(diff => `
                <div class="diff-item ${diff.type}">
                    <div class="diff-header">
                        <span class="diff-label ${diff.type}">
                            ${diff.type === 'added' ? 'ADDED' : diff.type === 'removed' ? 'REMOVED' : 'MODIFIED'}
                        </span>
                    </div>
                    <div class="diff-title">${diff.title || 'Untitled'}</div>
                    <div class="diff-content">${diff.content}</div>
                </div>
            `).join('');
        }

        function setViewMode(mode) {
            // Toggle active class on buttons
            document.querySelectorAll('.toolbar-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function toggleHighlight(type) {
            event.target.classList.toggle('active');
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
